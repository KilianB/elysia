// @bun
var W$=Object.create;var{defineProperty:D1,getPrototypeOf:Z$,getOwnPropertyNames:X$}=Object;var J$=Object.prototype.hasOwnProperty;var T0=($,W,Z)=>{Z=$!=null?W$(Z$($)):{};const X=W||!$||!$.__esModule?D1(Z,"default",{value:$,enumerable:!0}):Z;for(let J of X$($))if(!J$.call(X,J))D1(X,J,{get:()=>$[J],enumerable:!0});return X};var J0=($,W)=>()=>(W||$((W={exports:{}}).exports,W),W.exports);var M1=J0((u$,i0)=>{var z0=function(){},Q$=function($,W,Z){this.fn=$,this.context=W,this.once=Z||!1},U1=function($,W,Z,X,J){if(typeof Z!=="function")throw new TypeError("The listener must be a function");var Q=new Q$(Z,X||$,J),Y=f?f+W:W;if(!$._events[Y])$._events[Y]=Q,$._eventsCount++;else if(!$._events[Y].fn)$._events[Y].push(Q);else $._events[Y]=[$._events[Y],Q];return $},E0=function($,W){if(--$._eventsCount===0)$._events=new z0;else delete $._events[W]},g=function(){this._events=new z0,this._eventsCount=0},Y$=Object.prototype.hasOwnProperty,f="~";if(Object.create){if(z0.prototype=Object.create(null),!new z0().__proto__)f=!1}g.prototype.eventNames=function $(){var W=[],Z,X;if(this._eventsCount===0)return W;for(X in Z=this._events)if(Y$.call(Z,X))W.push(f?X.slice(1):X);if(Object.getOwnPropertySymbols)return W.concat(Object.getOwnPropertySymbols(Z));return W};g.prototype.listeners=function $(W){var Z=f?f+W:W,X=this._events[Z];if(!X)return[];if(X.fn)return[X.fn];for(var J=0,Q=X.length,Y=new Array(Q);J<Q;J++)Y[J]=X[J].fn;return Y};g.prototype.listenerCount=function $(W){var Z=f?f+W:W,X=this._events[Z];if(!X)return 0;if(X.fn)return 1;return X.length};g.prototype.emit=function $(W,Z,X,J,Q,Y){var _=f?f+W:W;if(!this._events[_])return!1;var B=this._events[_],K=arguments.length,D,U;if(B.fn){if(B.once)this.removeListener(W,B.fn,void 0,!0);switch(K){case 1:return B.fn.call(B.context),!0;case 2:return B.fn.call(B.context,Z),!0;case 3:return B.fn.call(B.context,Z,X),!0;case 4:return B.fn.call(B.context,Z,X,J),!0;case 5:return B.fn.call(B.context,Z,X,J,Q),!0;case 6:return B.fn.call(B.context,Z,X,J,Q,Y),!0}for(U=1,D=new Array(K-1);U<K;U++)D[U-1]=arguments[U];B.fn.apply(B.context,D)}else{var V=B.length,F;for(U=0;U<V;U++){if(B[U].once)this.removeListener(W,B[U].fn,void 0,!0);switch(K){case 1:B[U].fn.call(B[U].context);break;case 2:B[U].fn.call(B[U].context,Z);break;case 3:B[U].fn.call(B[U].context,Z,X);break;case 4:B[U].fn.call(B[U].context,Z,X,J);break;default:if(!D)for(F=1,D=new Array(K-1);F<K;F++)D[F-1]=arguments[F];B[U].fn.apply(B[U].context,D)}}}return!0};g.prototype.on=function $(W,Z,X){return U1(this,W,Z,X,!1)};g.prototype.once=function $(W,Z,X){return U1(this,W,Z,X,!0)};g.prototype.removeListener=function $(W,Z,X,J){var Q=f?f+W:W;if(!this._events[Q])return this;if(!Z)return E0(this,Q),this;var Y=this._events[Q];if(Y.fn){if(Y.fn===Z&&(!J||Y.once)&&(!X||Y.context===X))E0(this,Q)}else{for(var _=0,B=[],K=Y.length;_<K;_++)if(Y[_].fn!==Z||J&&!Y[_].once||X&&Y[_].context!==X)B.push(Y[_]);if(B.length)this._events[Q]=B.length===1?B[0]:B;else E0(this,Q)}return this};g.prototype.removeAllListeners=function $(W){var Z;if(W){if(Z=f?f+W:W,this._events[Z])E0(this,Z)}else this._events=new z0,this._eventsCount=0;return this};g.prototype.off=g.prototype.removeListener;g.prototype.addListener=g.prototype.on;g.prefixed=f;g.EventEmitter=g;if(typeof i0!=="undefined")i0.exports=g});var Z1=J0((G6,T1)=>{var F$=function($){var W=$.indexOf("%");if(W===-1)return $;var Z=$.length,X="",J=0,Q=0,Y=W,_=S1;while(W>-1&&W<Z){var B=q1($[W+1],4),K=q1($[W+2],0),D=B|K,U=W1[D];if(_=W1[256+_+U],Q=Q<<6|D&W1[364+U],_===S1)X+=$.slice(J,Y),X+=Q<=65535?String.fromCharCode(Q):String.fromCharCode(55232+(Q>>10),56320+(Q&1023)),Q=0,J=W+3,W=Y=$.indexOf("%",J);else if(_===j$)return null;else{if(W+=3,W<Z&&$.charCodeAt(W)===37)continue;return null}}return X+$.slice(J)},q1=function($,W){var Z=A$[$];return Z===void 0?255:Z<<W},S1=12,j$=0,W1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,10,9,9,9,11,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,24,36,48,60,72,84,96,0,12,12,12,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,24,24,24,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,48,48,48,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,127,63,63,63,0,31,15,15,15,7,7,7],A$={"0":0,"1":1,"2":2,"3":3,"4":4,"5":5,"6":6,"7":7,"8":8,"9":9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};T1.exports=F$});var x1=J0((D6,b1)=>{var V$=function($){const W=new L1;if(typeof $!=="string")return W;let Z=$.length,X="",J="",Q=-1,Y=-1,_=!1,B=!1,K=!1,D=!1,U=!1,V=0;for(let F=0;F<Z+1;F++)if(V=F!==Z?$.charCodeAt(F):38,V===38){if(U=Y>Q,!U)Y=F;if(X=$.slice(Q+1,Y),U||X.length>0){if(K)X=X.replace(H1," ");if(_)X=E1(X)||X;if(U){if(J=$.slice(Y+1,F),D)J=J.replace(H1," ");if(B)J=E1(J)||J}const z=W[X];if(z===void 0)W[X]=J;else if(z.pop)z.push(J);else W[X]=[z,J]}J="",Q=F,Y=F,_=!1,B=!1,K=!1,D=!1}else if(V===61)if(Y<=Q)Y=F;else B=!0;else if(V===43)if(Y>Q)D=!0;else K=!0;else if(V===37)if(Y>Q)B=!0;else _=!0;return W},E1=Z1(),H1=/\+/g,L1=function(){};L1.prototype=Object.create(null);b1.exports=V$});var f1=J0((K6,g1)=>{var R$=function($){const W=$.length;if(W===0)return"";let Z="",X=0,J=0;$:for(;J<W;J++){let Q=$.charCodeAt(J);while(Q<128){if(w$[Q]!==1){if(X<J)Z+=$.slice(X,J);X=J+1,Z+=i[Q]}if(++J===W)break $;Q=$.charCodeAt(J)}if(X<J)Z+=$.slice(X,J);if(Q<2048){X=J+1,Z+=i[192|Q>>6]+i[128|Q&63];continue}if(Q<55296||Q>=57344){X=J+1,Z+=i[224|Q>>12]+i[128|Q>>6&63]+i[128|Q&63];continue}if(++J,J>=W)throw new Error("URI malformed");const Y=$.charCodeAt(J)&1023;X=J+1,Q=65536+((Q&1023)<<10|Y),Z+=i[240|Q>>18]+i[128|Q>>12&63]+i[128|Q>>6&63]+i[128|Q&63]}if(X===0)return $;if(X<W)return Z+$.slice(X);return Z},i=Array.from({length:256},($,W)=>"%"+((W<16?"0":"")+W.toString(16)).toUpperCase()),w$=new Int8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0]);g1.exports={encodeString:R$}});var u1=J0((z6,v1)=>{var y1=function($){const W=typeof $;if(W==="string")return X1($);else if(W==="bigint")return $.toString();else if(W==="boolean")return $?"true":"false";else if(W==="number"&&Number.isFinite($))return $<1000000000000000000000?""+$:X1(""+$);return""},C$=function($){let W="";if($===null||typeof $!=="object")return W;const Z="&",X=Object.keys($),J=X.length;let Q=0;for(let Y=0;Y<J;Y++){const _=X[Y],B=$[_],K=X1(_)+"=";if(Y)W+=Z;if(Array.isArray(B)){Q=B.length;for(let D=0;D<Q;D++){if(D)W+=Z;W+=K,W+=y1(B[D])}}else W+=K,W+=y1(B)}return W},{encodeString:X1}=f1();v1.exports=C$});var J1=J0((U6,j0)=>{var k1=x1(),m1=u1(),h1={parse:k1,stringify:m1};j0.exports=h1;j0.exports.default=h1;j0.exports.parse=k1;j0.exports.stringify=m1});var Y0=($,W)=>({part:$,store:null,inert:W!==void 0?new Map(W.map((Z)=>[Z.part.charCodeAt(0),Z])):null,params:null,wildcardStore:null}),K1=($,W)=>({...$,part:W}),z1=($)=>({paramName:$,store:null,inert:null});class a{root={};history=[];static regex={static:/:.+?(?=\/|$)/,params:/:.+?(?=\/|$)/g};add($,W,Z){if(typeof W!=="string")throw new TypeError("Route path must be a string");if(W==="")W="/";else if(W[0]!=="/")W=`/${W}`;this.history.push([$,W,Z]);const X=W[W.length-1]==="*";if(X)W=W.slice(0,-1);const J=W.split(a.regex.static),Q=W.match(a.regex.params)||[];if(J[J.length-1]==="")J.pop();let Y;if(!this.root[$])Y=this.root[$]=Y0("/");else Y=this.root[$];let _=0;for(let B=0;B<J.length;++B){let K=J[B];if(B>0){const D=Q[_++].slice(1);if(Y.params===null)Y.params=z1(D);else if(Y.params.paramName!==D)throw new Error(`Cannot create route "${W}" with parameter "${D}" `+"because a route already exists with a different parameter name "+`("${Y.params.paramName}") in the same location`);const U=Y.params;if(U.inert===null){Y=U.inert=Y0(K);continue}Y=U.inert}for(let D=0;;){if(D===K.length){if(D<Y.part.length){const U=K1(Y,Y.part.slice(D));Object.assign(Y,Y0(K,[U]))}break}if(D===Y.part.length){if(Y.inert===null)Y.inert=new Map;else if(Y.inert.has(K.charCodeAt(D))){Y=Y.inert.get(K.charCodeAt(D)),K=K.slice(D),D=0;continue}const U=Y0(K.slice(D));Y.inert.set(K.charCodeAt(D),U),Y=U;break}if(K[D]!==Y.part[D]){const U=K1(Y,Y.part.slice(D)),V=Y0(K.slice(D));Object.assign(Y,Y0(Y.part.slice(0,D),[U,V])),Y=V;break}++D}}if(_<Q.length){const B=Q[_].slice(1);if(Y.params===null)Y.params=z1(B);else if(Y.params.paramName!==B)throw new Error(`Cannot create route "${W}" with parameter "${B}" `+"because a route already exists with a different parameter name "+`("${Y.params.paramName}") in the same location`);if(Y.params.store===null)Y.params.store=Z;return Y.params.store}if(X){if(Y.wildcardStore===null)Y.wildcardStore=Z;return Y.wildcardStore}if(Y.store===null)Y.store=Z;return Y.store}find($,W){const Z=this.root[$];if(!Z)return null;return p0(W,W.length,Z,0)}}var p0=($,W,Z,X)=>{const J=Z?.part,Q=X+J.length;if(J.length>1){if(Q>W)return null;if(J.length<15){for(let Y=1,_=X+1;Y<J.length;++Y,++_)if(J.charCodeAt(Y)!==$.charCodeAt(_))return null}else if($.substring(X,Q)!==J)return null}if(Q===W){if(Z.store!==null)return{store:Z.store,params:{}};if(Z.wildcardStore!==null)return{store:Z.wildcardStore,params:{"*":""}};return null}if(Z.inert!==null){const Y=Z.inert.get($.charCodeAt(Q));if(Y!==void 0){const _=p0($,W,Y,Q);if(_!==null)return _}}if(Z.params!==null){const Y=Z.params,_=$.indexOf("/",Q);if(_!==Q){if(_===-1||_>=W){if(Y.store!==null){const B={};return B[Y.paramName]=$.substring(Q,W),{store:Y.store,params:B}}}else if(Y.inert!==null){const B=p0($,W,Y.inert,_);if(B!==null)return B.params[Y.paramName]=$.substring(Q,_),B}}}if(Z.wildcardStore!==null)return{store:Z.wildcardStore,params:{"*":$.substring(Q,W)}};return null};var I1=T0(M1(),1);var O1=I1.default;var H0=()=>{let $;return[new Promise((Z)=>{$=Z}),$]},t=()=>{const[$,W]=H0(),[Z,X]=H0(),J=[],Q=[];return{signal:$,consume:(Y)=>{switch(Y.type){case"begin":if(Y.unit&&J.length===0)for(let _=0;_<Y.unit;_++){const[B,K]=H0(),[D,U]=H0();J.push(B),Q.push([(V)=>{K({children:[],end:D,name:V.name??"",skip:!1,time:V.time})},(V)=>{U(V)}])}W({children:J,end:Z,name:Y.name??"",skip:!1,time:Y.time});break;case"end":X(Y.time);break}},consumeChild(Y){switch(Y.type){case"begin":if(!Q[0])return;const[_]=Q[0];_({children:[],end:Z,name:Y.name??"",skip:!1,time:Y.time});break;case"end":const B=Q.shift();if(!B)return;B[1](Y.time)}},resolve(){W({children:[],end:new Promise((Y)=>Y(0)),name:"",skip:!0,time:0});for(let[Y,_]of Q)Y({children:[],end:new Promise((B)=>B(0)),name:"",skip:!0,time:0}),_(0);X(0)}}},N1=($,W,Z)=>{return async function X(X){if(X.event!=="request"||X.type!=="begin")return;const J=X.id,Q=$(),Y=t(),_=t(),B=t(),K=t(),D=t(),U=t(),V=t(),F=t();Y.consume(X);const z=(A)=>{if(A.id===J)switch(A.event){case"request":Y.consume(A);break;case"request.unit":Y.consumeChild(A);break;case"parse":_.consume(A);break;case"parse.unit":_.consumeChild(A);break;case"transform":B.consume(A);break;case"transform.unit":B.consumeChild(A);break;case"beforeHandle":K.consume(A);break;case"beforeHandle.unit":K.consumeChild(A);break;case"handle":D.consume(A);break;case"afterHandle":U.consume(A);break;case"afterHandle.unit":U.consumeChild(A);break;case"error":V.consume(A);break;case"error.unit":V.consumeChild(A);break;case"response":if(A.type==="begin")Y.resolve(),_.resolve(),B.resolve(),K.resolve(),D.resolve(),U.resolve(),V.resolve();else Q.off("event",z);F.consume(A);break;case"response.unit":F.consumeChild(A);break;case"exit":Y.resolve(),_.resolve(),B.resolve(),K.resolve(),D.resolve(),U.resolve(),V.resolve();break}};Q.on("event",z),await Z({id:J,context:X.ctx,set:X.ctx?.set,store:X.ctx?.store,time:X.time,request:Y.signal,parse:_.signal,transform:B.signal,beforeHandle:K.signal,handle:D.signal,afterHandle:U.signal,error:V.signal,response:F.signal}),Q.emit(`res${J}.${W}`,void 0)}};import{Value as e0} from"@sinclair/typebox/value";import{Kind as n0} from"@sinclair/typebox";import{Value as y0} from"@sinclair/typebox/value";import{TypeCompiler as A1} from"@sinclair/typebox/compiler";var _$=function($,W){if(typeof $!=="string")throw new TypeError("argument str must be a string");var Z={},X=W||{},J=X.decode||D$,Q=0;while(Q<$.length){var Y=$.indexOf("=",Q);if(Y===-1)break;var _=$.indexOf(";",Q);if(_===-1)_=$.length;else if(_<Y){Q=$.lastIndexOf(";",Y-1)+1;continue}var B=$.slice(Q,Y).trim();if(Z[B]===void 0){var K=$.slice(Y+1,_).trim();if(K.charCodeAt(0)===34)K=K.slice(1,-1);Z[B]=U$(K,J)}Q=_+1}return Z},G$=function($,W,Z){var X=Z||{},J=X.encode||K$;if(typeof J!=="function")throw new TypeError("option encode is invalid");if(!L0.test($))throw new TypeError("argument name is invalid");var Q=J(W);if(Q&&!L0.test(Q))throw new TypeError("argument val is invalid");var Y=$+"="+Q;if(X.maxAge!=null){var _=X.maxAge-0;if(isNaN(_)||!isFinite(_))throw new TypeError("option maxAge is invalid");Y+="; Max-Age="+Math.floor(_)}if(X.domain){if(!L0.test(X.domain))throw new TypeError("option domain is invalid");Y+="; Domain="+X.domain}if(X.path){if(!L0.test(X.path))throw new TypeError("option path is invalid");Y+="; Path="+X.path}if(X.expires){var B=X.expires;if(!z$(B)||isNaN(B.valueOf()))throw new TypeError("option expires is invalid");Y+="; Expires="+B.toUTCString()}if(X.httpOnly)Y+="; HttpOnly";if(X.secure)Y+="; Secure";if(X.partitioned)Y+="; Partitioned";if(X.priority){var K=typeof X.priority==="string"?X.priority.toLowerCase():X.priority;switch(K){case"low":Y+="; Priority=Low";break;case"medium":Y+="; Priority=Medium";break;case"high":Y+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(X.sameSite){var D=typeof X.sameSite==="string"?X.sameSite.toLowerCase():X.sameSite;switch(D){case!0:Y+="; SameSite=Strict";break;case"lax":Y+="; SameSite=Lax";break;case"strict":Y+="; SameSite=Strict";break;case"none":Y+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return Y},D$=function($){return $.indexOf("%")!==-1?decodeURIComponent($):$},K$=function($){return encodeURIComponent($)},z$=function($){return B$.call($)==="[object Date]"||$ instanceof Date},U$=function($,W){try{return W($)}catch(Z){return $}};/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var b0=_$,x0=G$;var B$=Object.prototype.toString,L0=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;class k{$;W;name;setter;constructor($,W={}){this._value=$;this.property=W}get(){return this._value}get value(){return this._value}set value($){if(typeof $==="object"){if(JSON.stringify(this.value)===JSON.stringify($))return}else if(this.value===$)return;this._value=$,this.sync()}add($){const W=Object.assign(this.property,typeof $==="function"?$(Object.assign(this.property,this.value)):$);if("value"in W)this._value=W.value,delete W.value;return this.property=W,this.sync()}set($){const W=typeof $==="function"?$(Object.assign(this.property,this.value)):$;if("value"in W)this._value=W.value,delete W.value;return this.property=W,this.sync()}remove($){if(this.value===void 0)return;this.set({domain:$?.domain,expires:new Date(0),maxAge:0,path:$?.path,sameSite:$?.sameSite,secure:$?.secure,value:""})}get domain(){return this.property.domain}set domain($){if(this.property.domain===$)return;this.property.domain=$,this.sync()}get expires(){return this.property.expires}set expires($){if(this.property.expires?.getTime()===$?.getTime())return;this.property.expires=$,this.sync()}get httpOnly(){return this.property.httpOnly}set httpOnly($){if(this.property.domain===$)return;this.property.httpOnly=$,this.sync()}get maxAge(){return this.property.maxAge}set maxAge($){if(this.property.maxAge===$)return;this.property.maxAge=$,this.sync()}get path(){return this.property.path}set path($){if(this.property.path===$)return;this.property.path=$,this.sync()}get priority(){return this.property.priority}set priority($){if(this.property.priority===$)return;this.property.priority=$,this.sync()}get sameSite(){return this.property.sameSite}set sameSite($){if(this.property.sameSite===$)return;this.property.sameSite=$,this.sync()}get secure(){return this.property.secure}set secure($){if(this.property.secure===$)return;this.property.secure=$,this.sync()}toString(){return typeof this.value==="object"?JSON.stringify(this.value):this.value?.toString()??""}sync(){if(!this.name||!this.setter)return this;if(!this.setter.cookie)this.setter.cookie={[this.name]:Object.assign(this.property,{value:this.toString()})};else this.setter.cookie[this.name]=Object.assign(this.property,{value:this.toString()});return this}}var P1=($,W,Z)=>new Proxy($,{get(X,J){if(J in X)return X[J];const Q=new k(void 0,Z?{...Z}:void 0);return Q.setter=W,Q.name=J,Q},set(X,J,Q){if(!(Q instanceof k))return!1;if(!W.cookie)W.cookie={};return Q.setter=W,Q.name=J,Q.sync(),X[J]=Q,!0}}),g0=async($,W,{secret:Z,sign:X,...J}={})=>{if(!W)return P1({},$,J);const Q={},Y=typeof Z==="string";if(X&&X!==!0&&!Array.isArray(X))X=[X];const _=Object.keys(b0(W));for(let B=0;B<_.length;B++){const K=_[B];let D=b0(W)[K];if(X===!0||X?.includes(K)){if(!Z)throw new Error("No secret is provided to cookie plugin");if(Y){if(D=await l0(D,Z),D===!1)throw new U0(K)}else{let F=!0;for(let z=0;z<Z.length;z++){const A=await l0(D,Z[z]);if(A!==!1){D=A,F=!1;break}}if(F)throw new U0(K)}}if(D===void 0)continue;const U=D.charCodeAt(0);if(U===123||U===91)try{const F=new k(JSON.parse(D));F.setter=$,F.name=K,Q[K]=F;continue}catch{}if(f0(D))D=+D;else if(D==="true")D=!0;else if(D==="false")D=!1;const V=new k(D,J);V.setter=$,V.name=K,Q[K]=V}return P1(Q,$)};var M0="toJSON"in new Headers,m=($)=>{for(let W in $)return!0;return!1},I0=($,W)=>{const Z=$.size;if(Z&&W&&W.status!==206&&W.status!==304&&W.status!==412&&W.status!==416||!W&&Z){if(W){if(W.headers instanceof Headers){if(M0)W.headers=W.headers.toJSON();else for(let[X,J]of W.headers.entries())if(X in W.headers)W.headers[X]=J}return new Response($,{status:W.status,headers:Object.assign({"accept-ranges":"bytes","content-range":`bytes 0-${Z-1}/${Z}`},W.headers)})}return new Response($,{headers:{"accept-ranges":"bytes","content-range":`bytes 0-${Z-1}/${Z}`}})}return new Response($)},j1=($,W)=>{if(!$||!Array.isArray(W))return $;$.delete("Set-Cookie");for(let Z=0;Z<W.length;Z++){const X=W[Z].indexOf("=");$.append("Set-Cookie",`${W[Z].slice(0,X)}=${W[Z].slice(X+1)}`)}return $},F1=($)=>{if(!$||typeof $!=="object"||!m($))return;const W=[];for(let[Z,X]of Object.entries($)){if(!Z||!X)continue;if(Array.isArray(X.value))for(let J=0;J<X.value.length;J++){let Q=X.value[J];if(Q===void 0||Q===null)continue;if(typeof Q==="object")Q=JSON.stringify(Q);W.push(x0(Z,Q,X))}else{let J=X.value;if(J===void 0||J===null)continue;if(typeof J==="object")J=JSON.stringify(J);W.push(x0(Z,X.value,X))}}if(W.length===0)return;if(W.length===1)return W[0];return W},v=($,W)=>{if($?.[$.$passthrough])$=$[$.$passthrough];if($?.[c])W.status=$[c],$=$.response;if(m(W.headers)||W.status!==200||W.redirect||W.cookie){if(typeof W.status==="string")W.status=O0[W.status];if(W.redirect){if(W.headers.Location=W.redirect,!W.status||W.status<300||W.status>=400)W.status=302}if(W.cookie&&m(W.cookie))W.headers["Set-Cookie"]=F1(W.cookie);if(W.headers["Set-Cookie"]&&Array.isArray(W.headers["Set-Cookie"]))W.headers=j1(new Headers(W.headers),W.headers["Set-Cookie"]);switch($?.constructor?.name){case"String":return new Response($,W);case"Blob":return I0($,W);case"Object":case"Array":return Response.json($,W);case"ReadableStream":if(!W.headers["content-type"]?.startsWith("text/event-stream"))W.headers["content-type"]="text/event-stream; charset=utf-8";return new Response($,W);case void 0:if(!$)return new Response("",W);return Response.json($,W);case"Response":const Z={...W.headers};if(M0)W.headers=$.headers.toJSON();else for(let[J,Q]of $.headers.entries())if(J in W.headers)W.headers[J]=Q;for(let J in Z)$.headers.append(J,Z[J]);return $;case"Error":return h($,W);case"Promise":return $.then((J)=>v(J,W));case"Function":return v($(),W);case"Number":case"Boolean":return new Response($.toString(),W);case"Cookie":if($ instanceof k)return new Response($.value,W);return new Response($?.toString(),W);default:if($ instanceof Response){const J={...W.headers};if(M0)W.headers=$.headers.toJSON();else for(let[Q,Y]of $.headers.entries())if(Q in W.headers)W.headers[Q]=Y;for(let Q in J)$.headers.append(Q,J[Q]);return $}if($ instanceof Promise)return $.then((J)=>v(J,W));if($ instanceof Error)return h($,W);const X=JSON.stringify($);if(X.charCodeAt(0)===123){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}return new Response(X,W)}}else switch($?.constructor?.name){case"String":return new Response($);case"Blob":return I0($,W);case"Object":case"Array":return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"ReadableStream":return new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Error":return h($,W);case"Promise":return $.then((X)=>{const J=l(X);if(J!==void 0)return J;return new Response("")});case"Function":return l($());case"Number":case"Boolean":return new Response($.toString());case"Cookie":if($ instanceof k)return new Response($.value,W);return new Response($?.toString(),W);default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then((X)=>v(X,W));if($ instanceof Error)return h($,W);const Z=JSON.stringify($);if(Z.charCodeAt(0)===123)return new Response(JSON.stringify($),{headers:{"Content-Type":"application/json"}});return new Response(Z)}},y=($,W)=>{if($===void 0||$===null)return;if($?.$passthrough)$=$[$.$passthrough];if($?.[c])W.status=$[c],$=$.response;if(m(W.headers)||W.status!==200||W.redirect||W.cookie){if(typeof W.status==="string")W.status=O0[W.status];if(W.redirect){if(W.headers.Location=W.redirect,!W.status||W.status<300||W.status>=400)W.status=302}if(W.cookie&&m(W.cookie))W.headers["Set-Cookie"]=F1(W.cookie);if(W.headers["Set-Cookie"]&&Array.isArray(W.headers["Set-Cookie"]))W.headers=j1(new Headers(W.headers),W.headers["Set-Cookie"]);switch($?.constructor?.name){case"String":return new Response($,W);case"Blob":return I0($,W);case"Object":case"Array":return Response.json($,W);case"ReadableStream":if(!W.headers["content-type"]?.startsWith("text/event-stream"))W.headers["content-type"]="text/event-stream; charset=utf-8";return new Response($,W);case void 0:if(!$)return;return Response.json($,W);case"Response":const Z=Object.assign({},W.headers);if(M0)W.headers=$.headers.toJSON();else for(let[J,Q]of $.headers.entries())if(!(J in W.headers))W.headers[J]=Q;for(let J in Z)$.headers.append(J,Z[J]);if($.status!==W.status)W.status=$.status;return $;case"Promise":return $.then((J)=>{const Q=y(J,W);if(Q!==void 0)return Q;return});case"Error":return h($,W);case"Function":return y($(),W);case"Number":case"Boolean":return new Response($.toString(),W);case"Cookie":if($ instanceof k)return new Response($.value,W);return new Response($?.toString(),W);default:if($ instanceof Response){const J={...W.headers};if(M0)W.headers=$.headers.toJSON();else for(let[Q,Y]of $.headers.entries())if(Q in W.headers)W.headers[Q]=Y;for(let Q in J)$.headers.append(Q,J[Q]);return $}if($ instanceof Promise)return $.then((J)=>y(J,W));if($ instanceof Error)return h($,W);const X=JSON.stringify($);if(X.charCodeAt(0)===123){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}return new Response(X,W)}}else switch($?.constructor?.name){case"String":return new Response($);case"Blob":return I0($,W);case"Object":case"Array":return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"ReadableStream":return new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Promise":return $.then((X)=>{const J=y(X,W);if(J!==void 0)return J;return});case"Error":return h($,W);case"Function":return l($());case"Number":case"Boolean":return new Response($.toString());case"Cookie":if($ instanceof k)return new Response($.value,W);return new Response($?.toString(),W);default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then((X)=>y(X,W));if($ instanceof Error)return h($,W);const Z=JSON.stringify($);if(Z.charCodeAt(0)===123)return new Response(JSON.stringify($),{headers:{"Content-Type":"application/json"}});return new Response(Z)}},l=($)=>{if($?.$passthrough)$=$[$.$passthrough];if($?.[c])return v($.response,{status:$[c],headers:{}});switch($?.constructor?.name){case"String":return new Response($);case"Blob":return I0($);case"Object":case"Array":return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"ReadableStream":return new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Error":return h($);case"Promise":return $.then(l);case"Function":return l($());case"Number":case"Boolean":return new Response($.toString());default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then(l);if($ instanceof Error)return h($);const W=JSON.stringify($);if(W.charCodeAt(0)===123)return new Response(JSON.stringify($),{headers:{"Content-Type":"application/json"}});return new Response(W)}},h=($,W)=>new Response(JSON.stringify({name:$?.name,message:$?.message,cause:$?.cause}),{status:W?.status!==200?W?.status??500:500,headers:W?.headers});var r0=($)=>$&&typeof $==="object"&&!Array.isArray($),t0=($,W)=>{const Z=new URL($);return Z.pathname=W,Z.toString()},M$=($)=>typeof $==="function"&&/^\s*class\s+/.test($.toString())||$.toString().startsWith("[object ")||m(Object.getPrototypeOf($)),d=($,W,{skipKeys:Z}={})=>{if(r0($)&&r0(W))for(let[X,J]of Object.entries(W)){if(Z?.includes(X))continue;if(!r0(J)){$[X]=J;continue}if(!(X in $)){$[X]=J;continue}if(M$(J)){$[X]=J;continue}$[X]=d($[X],J)}return $},V1=($,W)=>d($,W,{skipKeys:["properties"]}),H=($,W)=>{if(!$)return[];const Z=[...Array.isArray($)?$:[$]],X=[];for(let J of Z)if(J.$elysiaChecksum)X.push(J.$elysiaChecksum);for(let J of Array.isArray(W)?W:[W])if(!X.includes(J?.$elysiaChecksum))Z.push(J);return Z},I$=["start","request","parse","transform","resolve","beforeHandle","afterHandle","onResponse","mapResponse","trace","error","stop","body","headers","params","query","response","type","detail"],s=($,W)=>{return{...$,...W,body:W?.body??$?.body,headers:W?.headers??$?.headers,params:W?.params??$?.params,query:W?.query??$?.query,response:W?.response??$?.response,type:$?.type||W?.type,detail:d(W?.detail??{},$?.detail??{}),parse:H($?.parse??[],W?.parse??[]),transform:H($?.transform??[],W?.transform??[]),beforeHandle:H($?.beforeHandle??[],W?.beforeHandle??[]),afterHandle:H($?.afterHandle??[],W?.afterHandle??[]),onResponse:H($?.onResponse??[],W?.onResponse??[]),mapResponse:H($?.mapResponse??[],W?.mapResponse??[]),trace:H($?.trace??[],W?.trace??[]),error:H($?.error??[],W?.error??[])}},p=($,{models:W={},additionalProperties:Z=!1,dynamic:X=!1})=>{if(!$)return;if(typeof $==="string"&&!($ in W))return;const J=typeof $==="string"?W[$]:$;if(J.type==="object"&&"additionalProperties"in J===!1)J.additionalProperties=Z;if(X)return{schema:J,references:"",checkFunc:()=>{},code:"",Check:(Q)=>y0.Check(J,Q),Errors:(Q)=>y0.Errors(J,Q),Code:()=>""};return A1.Compile(J,Object.values(W))},s0=($,{models:W={},additionalProperties:Z=!1,dynamic:X=!1})=>{if(!$)return;if(typeof $==="string"&&!($ in W))return;const J=typeof $==="string"?W[$]:$,Q=(_,B)=>{if(X)return{schema:_,references:"",checkFunc:()=>{},code:"",Check:(K)=>y0.Check(_,K),Errors:(K)=>y0.Errors(_,K),Code:()=>""};return A1.Compile(_,B)};if(n0 in J){if("additionalProperties"in J===!1)J.additionalProperties=Z;return{200:Q(J,Object.values(W))}}const Y={};return Object.keys(J).forEach((_)=>{const B=J[+_];if(typeof B==="string"){if(B in W){const K=W[B];K.type==="object"&&"additionalProperties"in K,Y[+_]=n0 in K?Q(K,Object.values(W)):K}return}if(B.type==="object"&&"additionalProperties"in B===!1)B.additionalProperties=Z;Y[+_]=n0 in B?Q(B,Object.values(W)):B}),Y},O$=typeof Bun!=="undefined",N$=O$&&typeof Bun.hash==="function",N0=($)=>{if(N$)return Bun.hash($);let W=9;for(let Z=0;Z<$.length;)W=Math.imul(W^$.charCodeAt(Z++),387420489);return W=W^W>>>9},v0=($,W,Z)=>{const X=(J)=>{if(Z&&!J.$elysiaChecksum)J.$elysiaChecksum=Z;return J};return{...$,...W,start:H($.start,("start"in W?W.start??[]:[]).map(X)),request:H($.request,("request"in W?W.request??[]:[]).map(X)),parse:H($.parse,"parse"in W?W?.parse??[]:[]).map(X),transform:H($.transform,(W?.transform??[]).map(X)),beforeHandle:H($.beforeHandle,(W?.beforeHandle??[]).map(X)),afterHandle:H($.afterHandle,(W?.afterHandle??[]).map(X)),mapResponse:H($.mapResponse,(W?.mapResponse??[]).map(X)),onResponse:H($.onResponse,(W?.onResponse??[]).map(X)),trace:$.trace,error:H($.error,(W?.error??[]).map(X)),stop:H($.stop,("stop"in W?W.stop??[]:[]).map(X))}};var w1=($,W=!0)=>{if(!$)return $;if(typeof $==="function"){if(W)$.$elysiaHookType="global";else $.$elysiaHookType=void 0;return $}return $.map((Z)=>{if(W)Z.$elysiaHookType="global";else Z.$elysiaHookType=void 0;return Z})},Q0=($)=>{if(!$)return $;if(typeof $==="function")return $.$elysiaHookType==="global"?$:void 0;return $.filter((W)=>W.$elysiaHookType==="global")},a0=($)=>{return{...$,type:$?.type,detail:$?.detail,parse:Q0($?.parse),transform:Q0($?.transform),beforeHandle:Q0($?.beforeHandle),afterHandle:Q0($?.afterHandle),onResponse:Q0($?.onResponse),error:Q0($?.error)}},O0={Continue:100,"Switching Protocols":101,Processing:102,"Early Hints":103,OK:200,Created:201,Accepted:202,"Non-Authoritative Information":203,"No Content":204,"Reset Content":205,"Partial Content":206,"Multi-Status":207,"Already Reported":208,"Multiple Choices":300,"Moved Permanently":301,Found:302,"See Other":303,"Not Modified":304,"Temporary Redirect":307,"Permanent Redirect":308,"Bad Request":400,Unauthorized:401,"Payment Required":402,Forbidden:403,"Not Found":404,"Method Not Allowed":405,"Not Acceptable":406,"Proxy Authentication Required":407,"Request Timeout":408,Conflict:409,Gone:410,"Length Required":411,"Precondition Failed":412,"Payload Too Large":413,"URI Too Long":414,"Unsupported Media Type":415,"Range Not Satisfiable":416,"Expectation Failed":417,"I'm a teapot":418,"Misdirected Request":421,"Unprocessable Content":422,Locked:423,"Failed Dependency":424,"Too Early":425,"Upgrade Required":426,"Precondition Required":428,"Too Many Requests":429,"Request Header Fields Too Large":431,"Unavailable For Legal Reasons":451,"Internal Server Error":500,"Not Implemented":501,"Bad Gateway":502,"Service Unavailable":503,"Gateway Timeout":504,"HTTP Version Not Supported":505,"Variant Also Negotiates":506,"Insufficient Storage":507,"Loop Detected":508,"Not Extended":510,"Network Authentication Required":511},B0=async($,W)=>{if(typeof $!=="string")throw new TypeError("Cookie value must be provided as a string.");if(W===null)throw new TypeError("Secret key must be provided.");const Z=new TextEncoder,X=await crypto.subtle.importKey("raw",Z.encode(W),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),J=await crypto.subtle.sign("HMAC",X,Z.encode($)),Q=Array.from(new Uint8Array(J)),Y=btoa(String.fromCharCode(...Q));return`${$}.${Y.replace(/=+$/,"")}`},l0=async($,W)=>{if(typeof $!=="string")throw new TypeError("Signed cookie string must be provided.");if(W===null)throw new TypeError("Secret key must be provided.");const Z=$.slice(0,$.lastIndexOf("."));return await B0(Z,W)===$?Z:!1},o0=($,W,Z=W)=>{for(let[X,J]of Object.entries(W??{})){if(I$.includes(X)||!(X in $))continue;if(typeof $[X]==="function")$[X](J);else if(typeof $[X]==="object")o0($[X],J,Z)}},f0=($)=>$.trim().length!==0&&!Number.isNaN(Number($));var R1=typeof Bun!=="undefined"?Bun.env:typeof process!=="undefined"?process?.env:void 0,_0=Symbol("ElysiaErrorCode"),c=Symbol("ElysiaResponse"),P0=(R1?.NODE_ENV??R1?.ENV)==="production",P$=($,W)=>({[c]:O0[$]??$,response:W});class u0 extends Error{code="INTERNAL_SERVER_ERROR";status=500;constructor($){super($??"INTERNAL_SERVER_ERROR")}}class o extends Error{code="NOT_FOUND";status=404;constructor($){super($??"NOT_FOUND")}}class C1 extends Error{code="PARSE";status=400;constructor($){super($??"PARSE")}}class U0 extends Error{$;code="INVALID_COOKIE_SIGNATURE";status=400;constructor($,W){super(W??`"${$}" has invalid cookie signature`);this.key=$}}class T extends Error{$;W;Z;code="VALIDATION";status=400;constructor($,W,Z){const X=P0?void 0:("Errors"in W)?W.Errors(Z).First():e0.Errors(W,Z).First(),J=X?.schema.error?typeof X.schema.error==="function"?X.schema.error($,W,Z):X.schema.error:void 0,Q=X?.path?.slice(1)||"root";let Y="";if(J)Y=typeof J==="object"?JSON.stringify(J):J+"";else if(P0)Y=JSON.stringify({type:$,message:X?.message});else Y=JSON.stringify({type:$,at:Q,message:X?.message,expected:e0.Create(W.schema),found:Z,errors:[...W.Errors(Z)]},null,2);super(Y);this.type=$;this.validator=W;this.value=Z;Object.setPrototypeOf(this,T.prototype)}get all(){return[...this.validator.Errors(this.value)]}static simplifyModel($){const W="schema"in $?$.schema:$;try{return e0.Create(W)}catch{return W}}get model(){return T.simplifyModel(this.validator)}toResponse($){return new Response(this.message,{status:400,headers:$})}}var $1={open($){$.data.open?.($)},message($,W){$.data.message?.($,W)},drain($){$.data.drain?.($)},close($,W,Z){$.data.close?.($,W,Z)}};class G0{$;W;validator;constructor($,W){this.raw=$;this.data=W;if(this.validator=$.data.validator,$.data.id)this.id=$.data.id;else{const Z=new Uint32Array(1);crypto.getRandomValues(Z),this.id=Z[0].toString()}}get id(){return this.raw.data.id}set id($){this.raw.data.id=$}get publish(){return($,W=void 0,Z)=>{if(this.validator?.Check(W)===!1)throw new T("message",this.validator,W);if(typeof W==="object")W=JSON.stringify(W);return this.raw.publish($,W,Z),this}}get send(){return($)=>{if(this.validator?.Check($)===!1)throw new T("message",this.validator,$);if(Buffer.isBuffer($))return this.raw.send($),this;if(typeof $==="object")$=JSON.stringify($);return this.raw.send($),this}}get subscribe(){return($)=>{return this.raw.subscribe($),this}}get unsubscribe(){return($)=>{return this.raw.unsubscribe($),this}}get cork(){return($)=>{return this.raw.cork($),this}}get close(){return()=>{return this.raw.close(),this}}get terminate(){return this.raw.terminate.bind(this.raw)}get isSubscribed(){return this.raw.isSubscribed.bind(this.raw)}get remoteAddress(){return this.raw.remoteAddress}}var c1=T0(J1(),1),d1=T0(Z1(),1);import{Value as F0} from"@sinclair/typebox/value";var S$=(new Headers()).toJSON,p1=new RegExp(" (\\w+) = context","g"),i1={value:0},l1=({hasTrace:$,hasTraceSet:W=!1,addFn:Z,condition:X={}})=>{if($)return Z("\nconst reporter = getReporter()\n"),(J,{name:Q,attribute:Y="",unit:_=0}={})=>{const B=J.indexOf("."),K=B===-1;if(J!=="request"&&J!=="response"&&!X[K?J:J.slice(0,B)])return()=>{if(W&&J==="afterHandle")Z("\nawait traceDone\n")};if(K)Q||=J;else Q||="anonymous";Z("\n"+`reporter.emit('event', {
					id,
					event: '${J}',
					type: 'begin',
					name: '${Q}',
					time: performance.now(),
					${K?`unit: ${_},`:""}
					${Y}
				})`.replace(/(\t| |\n)/g,"")+"\n");let D=!1;return()=>{if(D)return;if(D=!0,Z("\n"+`reporter.emit('event', {
							id,
							event: '${J}',
							type: 'end',
							time: performance.now()
						})`.replace(/(\t| |\n)/g,"")+"\n"),W&&J==="afterHandle")Z("\nawait traceDone\n")}};else return()=>()=>{}},A0=($)=>{const W=$.indexOf(")");if($.charCodeAt(W+2)===61&&$.charCodeAt(W+5)!==123)return!0;return $.includes("return")},q$=($,{injectResponse:W=""}={})=>({composeValidation:(Z,X=`c.${Z}`)=>$?`c.set.status = 400; throw new ValidationError(
'${Z}',
${Z},
${X}
)`:`c.set.status = 400; return new ValidationError(
	'${Z}',
	${Z},
	${X}
).toResponse(c.set.headers)`,composeResponseValidation:(Z="r")=>{const X=$?`throw new ValidationError(
'response',
response[c.set.status],
${Z}
)`:`return new ValidationError(
'response',
response[c.set.status],
${Z}
).toResponse(c.set.headers)`;return`\n${W}
		if(!(${Z} instanceof Response) && response[c.set.status]?.Check(${Z}) === false) {
	if(!(response instanceof Error))
		${X}
}\n`}}),L=($,W)=>{if(W.startsWith("[object "))return!1;if(W=W.trimStart(),W=W.replaceAll(/^async /g,""),/^(\w+)\(/g.test(W))W=W.slice(W.indexOf("("));const Z=W.charCodeAt(0)===40||W.startsWith("function")?W.slice(W.indexOf("(")+1,W.indexOf(")")):W.slice(0,W.indexOf("=")-1);if(Z==="")return!1;const X=Z.charCodeAt(0)===123?Z.indexOf("..."):-1;if(Z.charCodeAt(0)===123){if(Z.includes($))return!0;if(X===-1)return!1}if(W.match(new RegExp(`${Z}(.${$}|\\["${$}"\\])`)))return!0;const J=X!==-1?Z.slice(X+3,Z.indexOf(" ",X+3)):void 0;if(W.match(new RegExp(`${J}(.${$}|\\["${$}"\\])`)))return!0;const Q=[Z];if(J)Q.push(J);for(let _ of W.matchAll(p1))Q.push(_[1]);const Y=new RegExp(`{.*?} = (${Q.join("|")})`,"g");for(let[_]of W.matchAll(Y))if(_.includes(`{ ${$}`)||_.includes(`, ${$}`))return!0;return!1},V0=($)=>{if($=$.trimStart(),$.startsWith("[object"))return!1;if($=$.replaceAll(/^async /g,""),/^(\w+)\(/g.test($))$=$.slice($.indexOf("("));const W=$.charCodeAt(0)===40||$.startsWith("function")?$.slice($.indexOf("(")+1,$.indexOf(")")):$.slice(0,$.indexOf("=")-1);if(W==="")return!1;const Z=W.charCodeAt(0)===123?W.indexOf("..."):-1,X=Z!==-1?W.slice(Z+3,W.indexOf(" ",Z+3)):void 0,J=[W];if(X)J.push(X);for(let Y of $.matchAll(p1))J.push(Y[1]);for(let Y of J)if(new RegExp(`\\b\\w+\\([^)]*\\b${Y}\\b[^)]*\\)`).test($))return!0;const Q=new RegExp(`{.*?} = (${J.join("|")})`,"g");for(let[Y]of $.matchAll(Q))if(new RegExp(`\\b\\w+\\([^)]*\\b${Y}\\b[^)]*\\)`).test($))return!0;return!1},D0=Symbol.for("TypeBox.Kind"),k0=($,W)=>{if(!W)return;if(D0 in W&&W[D0]===$)return!0;if(W.type==="object"){const Z=W.properties;for(let X of Object.keys(Z)){const J=Z[X];if(J.type==="object"){if(k0($,J))return!0}else if(J.anyOf){for(let Q=0;Q<J.anyOf.length;Q++)if(k0($,J.anyOf[Q]))return!0}if(D0 in J&&J[D0]===$)return!0}return!1}return W.properties&&D0 in W.properties&&W.properties[D0]===$},e=($,W)=>{if(!W)return;if(W.type==="object"){const Z=W.properties;if(!Z)return!1;for(let X of Object.keys(Z)){const J=Z[X];if($ in J)return!0;if(J.type==="object"){if(e($,J))return!0}else if(J.anyOf){for(let Q=0;Q<J.anyOf.length;Q++)if(e($,J.anyOf[Q]))return!0}}return!1}return $ in W},Y1=Symbol.for("TypeBox.Transform"),$0=($)=>{if(!$)return;if($.type==="object"&&$.properties){const W=$.properties;for(let Z of Object.keys(W)){const X=W[Z];if(X.type==="object"){if($0(X))return!0}else if(X.anyOf){for(let Q=0;Q<X.anyOf.length;Q++)if($0(X.anyOf[Q]))return!0}if(Y1 in X)return!0}return!1}return Y1 in $||$.properties&&Y1 in $.properties},T$=($)=>{if(!$)return;const W=$?.schema;if(W&&"anyOf"in W){let Z=!1;const X=W.anyOf[0].type;for(let J of W.anyOf)if(J.type!==X){Z=!0;break}if(!Z)return X}return $.schema?.type},E$=/(?:return|=>) \S+\(/g,b=($)=>{if($.constructor.name==="AsyncFunction")return!0;const W=$.toString();if(W.includes("=> response.clone("))return!1;return!!W.match(E$)},H$=($)=>{if(!$.includes("query: {")||$.includes("query,")||$.includes("query }"))return!1;const W=$.indexOf("query: {");return $=$.slice(W+9),$=$.slice(0,$.indexOf("}")),$.split(",").map((Z)=>{const X=Z.indexOf(":");if(X===-1)return Z.trim();return Z.slice(0,X).trim()})},n1=({path:$,method:W,hooks:Z,validator:X,handler:J,handleError:Q,definitions:Y,schema:_,onRequest:B,config:K,getReporter:D,setHeader:U})=>{const V=K.forceErrorEncapsulation||Z.error.length>0||typeof Bun==="undefined"||Z.onResponse.length>0||!!Z.trace.length,F=typeof J==="function",z=F?"handler(c)":"handler",A=Z.onResponse.length?`\n;(async () => {${Z.onResponse.map((I,O)=>`await res${O}(c)`).join(";")}})();\n`:"",M=Z.trace.map((I)=>I.toString());let N=!1;if(F&&V0(J.toString()))N=!0;if(!N)for(let[I,O]of Object.entries(Z)){if(!Array.isArray(O)||!O.length||!["parse","transform","beforeHandle","afterHandle","onResponse"].includes(I))continue;for(let j of O){if(typeof j!=="function")continue;if(V0(j.toString())){N=!0;break}}if(N)break}const P={parse:M.some((I)=>L("parse",I)),transform:M.some((I)=>L("transform",I)),handle:M.some((I)=>L("handle",I)),beforeHandle:M.some((I)=>L("beforeHandle",I)),afterHandle:M.some((I)=>L("afterHandle",I)),error:V||M.some((I)=>L("error",I))},w=Z.trace.length>0;let G="";const u=X||W!=="GET"&&W!=="HEAD"?[J,...Z.transform,...Z.beforeHandle,...Z.afterHandle,...Z.mapResponse].map((I)=>typeof I==="function"?I.toString():`${I}`):[],w0=W!=="GET"&&W!=="HEAD"&&(N||Z.type!=="none"&&(!!X.body||!!Z.type||u.some((I)=>L("body",I)))),h0=N||X.headers||u.some((I)=>L("headers",I))||U&&Object.keys(U).length,R0=N||!!X.cookie||u.some((I)=>L("cookie",I)),x=X?.cookie?.schema;let r="";if(x?.sign){if(!x.secrets)throw new Error(`t.Cookie required secret which is not set in (${W}) ${$}.`);const I=!x.secrets?void 0:typeof x.secrets==="string"?x.secrets:x.secrets[0];if(r+=`const _setCookie = c.set.cookie
		if(_setCookie) {`,x.sign===!0)r+=`for(const [key, cookie] of Object.entries(_setCookie)) {
				c.set.cookie[key].value = await signCookie(cookie.value, '${I}')
			}`;else for(let O of x.sign)r+=`if(_setCookie['${O}']?.value) { c.set.cookie['${O}'].value = await signCookie(_setCookie['${O}'].value, '${I}') }\n`;r+="}\n"}const{composeValidation:Z0,composeResponseValidation:C0}=q$(V);if(h0)G+=S$?"c.headers = c.request.headers.toJSON()\n":`c.headers = {}
                for (const [key, value] of c.request.headers.entries())
					c.headers[key] = value
				`;if(R0){const I=(j,R)=>{const S=x?.[j]??R;if(!S)return typeof R==="string"?`${j}: "${R}",`:`${j}: ${R},`;if(typeof S==="string")return`${j}: '${S}',`;if(S instanceof Date)return`${j}: new Date(${S.getTime()}),`;return`${j}: ${S},`},O=x?`{
			secret: ${x.secrets!==void 0?typeof x.secrets==="string"?`'${x.secrets}'`:"["+x.secrets.reduce((j,R)=>j+`'${R}',`,"")+"]":"undefined"},
			sign: ${x.sign===!0?!0:x.sign!==void 0?"["+x.sign.reduce((j,R)=>j+`'${R}',`,"")+"]":"undefined"},
			${I("domain")}
			${I("expires")}
			${I("httpOnly")}
			${I("maxAge")}
			${I("path","/")}
			${I("priority")}
			${I("sameSite")}
			${I("secure")}
		}`:"undefined";if(h0)G+=`\nc.cookie = await parseCookie(c.set, c.headers.cookie, ${O})\n`;else G+=`\nc.cookie = await parseCookie(c.set, c.request.headers.get('cookie'), ${O})\n`}if(N||X.query||u.some((I)=>L("query",I))){let I=[],O=!1;if(X.query&&X.query.schema.type==="object")I=Object.keys(X.query.schema.properties);else for(let j of u){const R=H$(j);if(!R){O=!0;continue}for(let S of R)if(I.indexOf(S)===-1)I.push(S)}if(!O&&I.length)G+=`
			let requestUrl = c.request.url.slice(c.qi + 1)
			if(requestUrl.includes('+')) requestUrl = requestUrl.replaceAll('+', ' ')

			if(c.qi !== -1) {	
				const url = decodeURIComponent(requestUrl)
				let memory = 0

				${I.map((j,R)=>`
						memory = url.indexOf('${j}=')

						const a${R} = memory === -1 ? undefined : url.slice(memory = memory + ${j.length+1}, (memory = url.indexOf('&', memory)) === -1 ? undefined : memory)`).join("\n")}

				c.query = {
					${I.map((j,R)=>`${j}: a${R}`).join(", ")}
				}
			} else {
				c.query = {}
			}`;else G+="c.query = c.qi !== -1 ? parseQuery(decodeURIComponent(c.request.url.slice(c.qi + 1))) : {}"}const S0=Z.trace.map((I)=>I.toString()).some((I)=>L("set",I)||V0(I));N||Z.trace.some((I)=>L("set",I.toString()));const q0=U&&Object.keys(U).length||S0||R0||u.some((I)=>L("set",I))||B.some((I)=>L("set",I.toString()));if(w)G+="\nconst id = c.$$requestId\n";const E=l1({hasTrace:w,hasTraceSet:S0,condition:P,addFn:(I)=>{G+=I}});if(G+=V?"\n try {\n":"",S0){G+="\nconst traceDone = Promise.all([";for(let I=0;I<Z.trace.length;I++)G+=`new Promise(r => { reporter.once(\`res\${id}.${I}\`, r) }),`;G+="])\n"}const X0=typeof J==="function"&&b(J),c0=R0||w0||S0||X0||!!Z.mapResponse.length||Z.parse.length>0||Z.afterHandle.some(b)||Z.beforeHandle.some(b)||Z.transform.some(b),o1=E("parse",{unit:Z.parse.length});if(w0){const I=T$(X?.body);if(Z.type&&!Array.isArray(Z.type)){if(Z.type)switch(Z.type){case"json":case"application/json":G+="c.body = await c.request.json()\n";break;case"text":case"text/plain":G+="c.body = await c.request.text()\n";break;case"urlencoded":case"application/x-www-form-urlencoded":G+="c.body = parseQuery(await c.request.text())\n";break;case"arrayBuffer":case"application/octet-stream":G+="c.body = await c.request.arrayBuffer()\n";break;case"formdata":case"multipart/form-data":G+=`c.body = {}

						const form = await c.request.formData()
						for (const key of form.keys()) {
							if (c.body[key])
								continue

							const value = form.getAll(key)
							if (value.length === 1)
								c.body[key] = value[0]
							else c.body[key] = value
						}\n`;break}if(Z.parse.length)G+="}}"}else{const j=(()=>{if(Z.parse.length&&I&&!Array.isArray(Z.type)){const R=X?.body?.schema;switch(I){case"object":if(k0("File",R)||k0("Files",R))return`c.body = {}

								const form = await c.request.formData()
								for (const key of form.keys()) {
									if (c.body[key])
										continue

									const value = form.getAll(key)
									if (value.length === 1)
										c.body[key] = value[0]
									else c.body[key] = value
								}`;break;default:break}}})();if(j)G+=j;else{if(G+="\n",G+=h0?"let contentType = c.headers['content-type']":"let contentType = c.request.headers.get('content-type')",G+=`
				if (contentType) {
					const index = contentType.indexOf(';')
					if (index !== -1) contentType = contentType.substring(0, index)\n`,Z.parse.length){G+="let used = false\n";const R=E("parse",{unit:Z.parse.length});for(let S=0;S<Z.parse.length;S++){const d0=E("parse.unit",{name:Z.parse[S].name}),q=`bo${S}`;if(S!==0)G+="if(!used) {\n";if(G+=`let ${q} = parse[${S}](c, contentType)\n`,G+=`if(${q} instanceof Promise) ${q} = await ${q}\n`,G+=`if(${q} !== undefined) { c.body = ${q}; used = true }\n`,d0(),S!==0)G+="}"}R()}if(Z.parse.length)G+="if (!used)";G+=`
				switch (contentType) {
					case 'application/json':
						c.body = await c.request.json()
						break

					case 'text/plain':
						c.body = await c.request.text()
						break

					case 'application/x-www-form-urlencoded':
						c.body = parseQuery(await c.request.text())
						break

					case 'application/octet-stream':
						c.body = await c.request.arrayBuffer();
						break

					case 'multipart/form-data':
						c.body = {}

						const form = await c.request.formData()
						for (const key of form.keys()) {
							if (c.body[key])
								continue

							const value = form.getAll(key)
							if (value.length === 1)
								c.body[key] = value[0]
							else c.body[key] = value
						}

						break
					}\n`,G+="}\n"}}G+="\n"}if(o1(),Z?.transform){const I=E("transform",{unit:Z.transform.length});for(let O=0;O<Z.transform.length;O++){const j=Z.transform[O],R=E("transform.unit",{name:j.name});if(j.$elysia==="derive")G+=b(j)?`Object.assign(c, await transform[${O}](c));`:`Object.assign(c, transform[${O}](c));`;else G+=b(j)?`await transform[${O}](c);`:`transform[${O}](c);`;R()}I()}if(X){if(G+="\n",X.headers){if(e("default",X.headers.params))for(let[I,O]of Object.entries(F0.Default(X.headers.schema,{}))){const j=typeof O==="object"?JSON.stringify(O):`'${O}'`;if(j)G+=`c.headers['${I}'] ??= ${j}\n`}if(G+=`if(headers.Check(c.headers) === false) {
				${Z0("headers")}
			}`,$0(X.headers.schema))G+="\nc.headers = headers.Decode(c.headers)\n"}if(X.params){if(e("default",X.params.schema))for(let[I,O]of Object.entries(F0.Default(X.params.schema,{}))){const j=typeof O==="object"?JSON.stringify(O):`'${O}'`;if(j)G+=`c.params['${I}'] ??= ${j}\n`}if(G+=`if(params.Check(c.params) === false) {
				${Z0("params")}
			}`,$0(X.params.schema))G+="\nc.params = params.Decode(c.params)\n"}if(X.query){if(e("default",X.query.schema))for(let[I,O]of Object.entries(F0.Default(X.query.schema,{}))){const j=typeof O==="object"?JSON.stringify(O):`'${O}'`;if(j)G+=`c.query['${I}'] ??= ${j}\n`}if(G+=`if(query.Check(c.query) === false) {
				${Z0("query")}
			}`,$0(X.query.schema))G+="\nc.query = query.Decode(Object.assign({}, c.query))\n"}if(X.body){if(e("default",X.body.schema))G+=`if(body.Check(c.body) === false) {
    				c.body = Object.assign(${JSON.stringify(F0.Default(X.body.schema,null)??{})}, c.body)

    				if(body.Check(c.query) === false) {
        				${Z0("body")}
     			}
            }`;else G+=`if(body.Check(c.body) === false) {
			${Z0("body")}
		}`;if($0(X.body.schema))G+="\nc.body = body.Decode(c.body)\n"}if(m(X.cookie?.schema.properties??{})){if(G+=`const cookieValue = {}
    			for(const [key, value] of Object.entries(c.cookie))
    				cookieValue[key] = value.value\n`,e("default",X.cookie.schema))for(let[I,O]of Object.entries(F0.Default(X.cookie.schema,{})))G+=`cookieValue['${I}'] = ${typeof O==="object"?JSON.stringify(O):O}\n`;if(G+=`if(cookie.Check(cookieValue) === false) {
				${Z0("cookie","cookieValue")}
			}`,$0(X.cookie.schema))G+="\nc.cookie = params.Decode(c.cookie)\n"}}if(Z?.beforeHandle){const I=E("beforeHandle",{unit:Z.beforeHandle.length});for(let O=0;O<Z.beforeHandle.length;O++){const j=Z.beforeHandle[O],R=E("beforeHandle.unit",{name:j.name}),S=A0(j.toString());if(j.$elysia==="resolve")G+=b(j)?`Object.assign(c, await beforeHandle[${O}](c));`:`Object.assign(c, beforeHandle[${O}](c));`;else if(!S)G+=b(j)?`await beforeHandle[${O}](c);\n`:`beforeHandle[${O}](c);\n`,R();else{G+=b(j)?`be = await beforeHandle[${O}](c);\n`:`be = beforeHandle[${O}](c);\n`,R(),G+="if(be !== undefined) {\n";const d0=E("afterHandle",{unit:Z.transform.length});if(Z.afterHandle){E("handle",{name:F?J.name:void 0})();for(let q=0;q<Z.afterHandle.length;q++){const e1=A0(Z.afterHandle[q].toString()),$$=E("afterHandle.unit",{name:Z.afterHandle[q].name});if(G+="c.response = be\n",!e1)G+=b(Z.afterHandle[q])?`await afterHandle[${q}](c, be)\n`:`afterHandle[${q}](c, be)\n`;else G+=b(Z.afterHandle[q])?`af = await afterHandle[${q}](c)\n`:`af = afterHandle[${q}](c)\n`,G+="if(af !== undefined) { c.response = be = af }\n";$$()}}if(d0(),X.response)G+=C0("be");if(Z.mapResponse.length){G+="c.response = be";for(let q=0;q<Z.mapResponse.length;q++)G+=`\nif(mr === undefined) {
							mr = onMapResponse[${q}](c)
							if(mr instanceof Promise) mr = await mr
							if(mr !== undefined) c.response = mr
						}\n`}G+=r,G+="return mapEarlyResponse(be, c.set)}\n"}}I()}if(Z?.afterHandle.length){const I=E("handle",{name:F?J.name:void 0});if(Z.afterHandle.length)G+=X0?`let r = c.response = await ${z};\n`:`let r = c.response = ${z};\n`;else G+=X0?`let r = await ${z};\n`:`let r = ${z};\n`;I();const O=E("afterHandle",{unit:Z.afterHandle.length});for(let j=0;j<Z.afterHandle.length;j++){const R=A0(Z.afterHandle[j].toString()),S=E("afterHandle.unit",{name:Z.afterHandle[j].name});if(!R)G+=b(Z.afterHandle[j])?`await afterHandle[${j}](c)\n`:`afterHandle[${j}](c)\n`,S();else if(G+=b(Z.afterHandle[j])?`af = await afterHandle[${j}](c)\n`:`af = afterHandle[${j}](c)\n`,S(),X.response)G+="if(af !== undefined) {",O(),G+=C0("af"),G+="c.response = af }";else G+="if(af !== undefined) {",O(),G+="c.response = af}\n"}if(O(),G+="r = c.response\n",X.response)G+=C0();if(G+=r,Z.mapResponse.length)for(let j=0;j<Z.mapResponse.length;j++)G+=`\nmr = onMapResponse[${j}](c)
				if(mr instanceof Promise) mr = await mr
				if(mr !== undefined) c.response = mr\n`;if(q0)G+="return mapResponse(r, c.set)\n";else G+="return mapCompactResponse(r)\n"}else{const I=E("handle",{name:F?J.name:void 0});if(X.response||Z.mapResponse.length){if(G+=X0?`let r = await ${z};\n`:`let r = ${z};\n`,I(),X.response)G+=C0();if(E("afterHandle")(),Z.mapResponse.length){G+="c.response = r";for(let O=0;O<Z.mapResponse.length;O++)G+=`\nif(mr === undefined) { 
						mr = onMapResponse[${O}](c)
						if(mr instanceof Promise) mr = await mr
    					if(mr !== undefined) r = c.response = mr
					}\n`}if(G+=r,J instanceof Response)G+=`return ${z}.clone()\n`;else if(q0)G+="return mapResponse(r, c.set)\n";else G+="return mapCompactResponse(r)\n"}else if(P.handle||R0){if(G+=X0?`let r = await ${z};\n`:`let r = ${z};\n`,I(),E("afterHandle")(),Z.mapResponse.length){G+="c.response = r";for(let O=0;O<Z.mapResponse.length;O++)G+=`\nif(mr === undefined) {
							mr = onMapResponse[${O}](c)
							if(mr instanceof Promise) mr = await mr
    						if(mr !== undefined) r = c.response = mr
						}\n`}if(G+=r,q0)G+="return mapResponse(r, c.set)\n";else G+="return mapCompactResponse(r)\n"}else{I();const O=X0?`await ${z}`:z;if(E("afterHandle")(),J instanceof Response)G+=`return ${z}.clone()\n`;else if(q0)G+=`return mapResponse(${O}, c.set)\n`;else G+=`return mapCompactResponse(${O})\n`}}if(V||A){if(G+=`
} catch(error) {`,!c0)G+="return (async () => {";G+=`const set = c.set

		if (!set.status || set.status < 300) set.status = error?.status || 500
	`;const I=E("error",{unit:Z.error.length});if(Z.error.length){G+=`
				c.error = error
				c.code = error.code ?? error[ERROR_CODE] ?? "UNKNOWN"
			`;for(let O=0;O<Z.error.length;O++){const j=`er${O}`,R=E("error.unit",{name:Z.error[O].name});if(G+=`\nlet ${j} = handleErrors[${O}](c)\n`,b(Z.error[O]))G+=`if (${j} instanceof Promise) ${j} = await ${j}\n`;R(),G+=`${j} = mapEarlyResponse(${j}, set)\n`,G+=`if (${j}) {`,G+=`return ${j} }\n`}}if(I(),G+="return handleError(c, error)\n\n",!c0)G+="})()";if(G+="}",A||w){G+=" finally { ";const O=E("response",{unit:Z.onResponse.length});G+=A,O(),G+="}"}}return G=`const {
		handler,
		handleError,
		hooks: {
			transform,
			resolve,
			beforeHandle,
			afterHandle,
			mapResponse: onMapResponse,
			parse,
			error: handleErrors,
			onResponse
		},
		validator: {
			body,
			headers,
			params,
			query,
			response,
			cookie
		},
		utils: {
			mapResponse,
			mapCompactResponse,
			mapEarlyResponse,
			parseQuery
		},
		error: {
			NotFoundError,
			ValidationError,
			InternalServerError
		},
		schema,
		definitions,
		ERROR_CODE,
		getReporter,
		requestId,
		parseCookie,
		signCookie,
		decodeURIComponent
	} = hooks

	${Z.onResponse.length?`const ${Z.onResponse.map((I,O)=>`res${O} = onResponse[${O}]`).join(",")}`:""}

	return ${c0?"async":""} function handle(c) {
		${Z.beforeHandle.length?"let be":""}
		${Z.afterHandle.length?"let af":""}
		${Z.mapResponse.length?"let mr":""}

		${_&&Y?"c.schema = schema; c.defs = definitions;":""}
		${G}
	}`,Function("hooks",G)({handler:J,hooks:Z,validator:X,handleError:Q,utils:{mapResponse:v,mapCompactResponse:l,mapEarlyResponse:y,parseQuery:c1.parse},error:{NotFoundError:o,ValidationError:T,InternalServerError:u0},schema:_,definitions:Y,ERROR_CODE:_0,getReporter:D,requestId:i1,parseCookie:g0,signCookie:B0,decodeURIComponent:d1.default})},Q1=($)=>{let W="",Z="";for(let z of Object.keys($.decorators))W+=`,${z}: app.decorators.${z}`;const{router:X,staticRouter:J}=$,Q=$.event.trace.length>0,Y=`
	const route = router.find(request.method, path) ${X.root.ALL?'?? router.find("ALL", path)':""}
	if (route === null)
		return ${$.event.error.length?"app.handleError(ctx, notFound)":$.event.request.length?`new Response(error404Message, {
					status: ctx.set.status === 200 ? 404 : ctx.set.status,
					headers: ctx.set.headers
				})`:"error404.clone()"}

	ctx.params = route.params

	return route.store(ctx)`;let _="";for(let[z,{code:A,all:M}]of Object.entries(J.map))_+=`case '${z}':\nswitch(request.method) {\n${A}\n${M??"default: break map"}}\n\n`;const B=$.event.request.some(b);if(Z+=`const {
		app,
		app: { store, router, staticRouter, wsRouter },
		mapEarlyResponse,
		NotFoundError,
		requestId,
		getReporter,
		handleError
	} = data

	const notFound = new NotFoundError()

	${$.event.request.length?"const onRequest = app.event.request":""}
	${J.variables}
	${$.event.error.length?"":`
	const error404Message = notFound.message.toString()
	const error404 = new Response(error404Message, { status: 404 });
	`}

	return ${B?"async":""} function map(request) {\n`,$.event.request.length)Z+="let re";const K=$.event.trace.map((z)=>z.toString()),D=l1({hasTrace:Q,hasTraceSet:$.event.trace.some((z)=>{const A=z.toString();return L("set",A)||V0(A)}),condition:{request:K.some((z)=>L("request",z)||V0(z))},addFn:(z)=>{Z+=z}});if($.event.request.length){Z+=`
			${Q?"const id = +requestId.value++":""}

			const ctx = {
				request,
				store,
				set: {
					headers: ${Object.keys($.setHeaders??{}).length?"Object.assign({}, app.setHeaders)":"{}"},
					status: 200
				}
				${Q?",$$requestId: +id":""}
				${W}
			}
		`;const z=D("request",{attribute:"ctx",unit:$.event.request.length});Z+="\n try {\n";for(let A=0;A<$.event.request.length;A++){const M=$.event.request[A],N=A0(M.toString()),P=b(M),w=D("request.unit",{name:$.event.request[A].name});if(N){if(Z+=`re = mapEarlyResponse(
					${P?"await":""} onRequest[${A}](ctx),
					ctx.set
				)\n`,w(),N)Z+="if(re !== undefined) return re\n"}else Z+=`${P?"await":""} onRequest[${A}](ctx)\n`,w()}Z+=`} catch (error) {
			return app.handleError(ctx, error)
		}`,z(),Z+=`
		const url = request.url
		const s = url.indexOf('/', 11)
		const qi = ctx.qi = url.indexOf('?', s + 1)
		const path = ctx.path = url.substring(s, qi === -1 ? undefined : qi)`}else Z+=`
		const url = request.url
		const s = url.indexOf('/', 11)
		const qi = url.indexOf('?', s + 1)
		const path = url.substring(s, qi === -1 ? undefined : qi)
		${Q?"const id = +requestId.value++":""}
		const ctx = {
			request,
			store,
			qi,
			path,
			set: {
				headers: ${Object.keys($.setHeaders??{}).length?"Object.assign({}, app.setHeaders)":"{}"},
				status: 200
			}
			${Q?",$$requestId: id":""}
			${W}
		}`,D("request",{unit:$.event.request.length,attribute:K.some((z)=>L("context",z))||K.some((z)=>L("store",z))||K.some((z)=>L("set",z))?"ctx":""})();const{wsPaths:U,wsRouter:V}=$;if(Object.keys(U).length||V.history.length){Z+=`
			if(request.method === 'GET') {
				switch(path) {`;for(let[z,A]of Object.entries(U))Z+=`
					case '${z}':
						if(request.headers.get('upgrade') === 'websocket')
							return st${A}(ctx)

						break`;Z+=`
				default:
					if(request.headers.get('upgrade') === 'websocket') {
						const route = wsRouter.find('ws', path)

						if(route) {
							ctx.params = route.params

							return route.store(ctx)
						}
					}

					break
			}
		}\n`}Z+=`
		map: switch(path) {
			${_}

			default:
				break
		}

		${Y}
	}`;const F=B1($);return $.handleError=F,Function("data",Z)({app:$,mapEarlyResponse:y,NotFoundError:o,getReporter:()=>$.reporter,requestId:i1,handleError:F})},B1=($)=>{let W=`const {
		app: { event: { error: onError, onResponse: res } },
		mapResponse,
		ERROR_CODE,
		ELYSIA_RESPONSE
	} = inject

	return ${$.event.error.find(b)?"async":""} function(context, error) {
		let r

		const { set } = context

		context.code = error.code
		context.error = error

		if(error[ELYSIA_RESPONSE]) {
			error.status = error[ELYSIA_RESPONSE]
			error.message = error.response
		}
`;for(let Z=0;Z<$.event.error.length;Z++){const X=$.event.error[Z],J=`${b(X)?"await ":""}onError[${Z}](context)`;if(A0(X.toString()))W+=`r = ${J}; if(r !== undefined) {
				if(r instanceof Response) return r

				if(r[ELYSIA_RESPONSE]) {
					error.status = error[ELYSIA_RESPONSE]
					error.message = error.response
				}
		
				if(set.status === 200) set.status = error.status
				return mapResponse(r, set)
			}\n`;else W+=J+"\n"}return W+=`if(error.constructor.name === "ValidationError" || error.constructor.name === "TransformDecodeError") {
		set.status = error.status ?? 400
		return new Response(
			error.message,
			{ headers: set.headers, status: set.status }
		)
	} else {
		if(error.code && typeof error.status === "number")
			return new Response(
				error.message,
				{ headers: set.headers, status: error.status }
			)

		return mapResponse(error, set)
	}
}`,Function("inject",W)({app:$,mapResponse:v,ERROR_CODE:_0,ELYSIA_RESPONSE:c})};var m0=T0(J1(),1);var _1=($)=>async(W)=>{const Z={cookie:{},status:200,headers:{}};let X;if($.decorators)X=$.decorators,X.request=W,X.set=Z,X.store=$.store;else X={set:Z,store:$.store,request:W};const J=W.url,Q=J.indexOf("/",11),Y=J.indexOf("?",Q+1),_=Y===-1?J.substring(Q):J.substring(Q,Y);try{for(let M=0;M<$.event.request.length;M++){const N=$.event.request[M];let P=N(X);if(P instanceof Promise)P=await P;if(P=y(P,Z),P)return P}const B=$.dynamicRouter.find(W.method,_)??$.dynamicRouter.find("ALL",_);if(!B)throw new o;const{handle:K,hooks:D,validator:U,content:V}=B.store;let F;if(W.method!=="GET"&&W.method!=="HEAD")if(V)switch(V){case"application/json":F=await W.json();break;case"text/plain":F=await W.text();break;case"application/x-www-form-urlencoded":F=m0.parse(await W.text());break;case"application/octet-stream":F=await W.arrayBuffer();break;case"multipart/form-data":F={};const M=await W.formData();for(let N of M.keys()){if(F[N])continue;const P=M.getAll(N);if(P.length===1)F[N]=P[0];else F[N]=P}break}else{let M=W.headers.get("content-type");if(M){const N=M.indexOf(";");if(N!==-1)M=M.slice(0,N);for(let P=0;P<D.parse.length;P++){let w=D.parse[P](X,M);if(w instanceof Promise)w=await w;if(w){F=w;break}}if(F===void 0)switch(M){case"application/json":F=await W.json();break;case"text/plain":F=await W.text();break;case"application/x-www-form-urlencoded":F=m0.parse(await W.text());break;case"application/octet-stream":F=await W.arrayBuffer();break;case"multipart/form-data":F={};const P=await W.formData();for(let w of P.keys()){if(F[w])continue;const G=P.getAll(w);if(G.length===1)F[w]=G[0];else F[w]=G}break}}}X.body=F,X.params=B?.params||void 0,X.query=Y===-1?{}:m0.parse(J.substring(Y+1)),X.headers={};for(let[M,N]of W.headers.entries())X.headers[M]=N;const z=U?.cookie?.schema;X.cookie=await g0(X.set,X.headers.cookie,z?{secret:z.secrets!==void 0?typeof z.secrets==="string"?z.secrets:z.secrets.join(","):void 0,sign:z.sign===!0?!0:z.sign!==void 0?typeof z.sign==="string"?z.sign:z.sign.join(","):void 0}:void 0);for(let M=0;M<D.transform.length;M++){const N=D.transform[M](X);if(D.transform[M].$elysia==="derive")if(N instanceof Promise)Object.assign(X,await N);else Object.assign(X,N);else if(N instanceof Promise)await N}if(U){if(U.headers){const M={};for(let N in W.headers)M[N]=W.headers.get(N);if(U.headers.Check(M)===!1)throw new T("header",U.headers,M)}if(U.params?.Check(X.params)===!1)throw new T("params",U.params,X.params);if(U.query?.Check(X.query)===!1)throw new T("query",U.query,X.query);if(U.cookie){const M={};for(let[N,P]of Object.entries(X.cookie))M[N]=P.value;if(U.cookie?.Check(M)===!1)throw new T("cookie",U.cookie,M)}if(U.body?.Check(F)===!1)throw new T("body",U.body,F)}for(let M=0;M<D.beforeHandle.length;M++){let N=D.beforeHandle[M](X);if(N instanceof Promise)N=await N;if(N!==void 0){X.response=N;for(let w=0;w<D.afterHandle.length;w++){let G=D.afterHandle[w](X);if(G instanceof Promise)G=await G;if(G)N=G}const P=y(N,X.set);if(P)return P}}let A=K(X);if(A instanceof Promise)A=await A;if(!D.afterHandle.length){const M=U?.response?.[A.status];if(M?.Check(A)===!1)throw new T("response",M,A)}else{X.response=A;for(let M=0;M<D.afterHandle.length;M++){let N=D.afterHandle[M](X);if(N instanceof Promise)N=await N;const P=y(N,X.set);if(P!==void 0){const w=U?.response?.[A.status];if(w?.Check(P)===!1)throw new T("response",w,P);return P}}}if(X.set.cookie&&z?.sign){const M=!z.secrets?void 0:typeof z.secrets==="string"?z.secrets:z.secrets[0];if(z.sign===!0)for(let[N,P]of Object.entries(X.set.cookie))X.set.cookie[N].value=await B0(P.value,"${secret}");else for(let N of z.sign){if(!(N in z.properties))continue;if(X.set.cookie[N]?.value)X.set.cookie[N].value=await B0(X.set.cookie[N].value,M)}}return v(A,X.set)}catch(B){if(B.status)Z.status=B.status;return $.handleError(X,B)}finally{for(let B of $.event.onResponse)await B(X)}},r1=($)=>async(W,Z)=>{const X=Object.assign(W,{error:Z,code:Z.code});X.set=W.set;for(let J=0;J<$.event.error.length;J++){let Q=$.event.error[J](X);if(Q instanceof Promise)Q=await Q;if(Q!==void 0&&Q!==null)return v(Q,W.set)}return new Response(typeof Z.cause==="string"?Z.cause:Z.message,{headers:W.set.headers,status:Z.status??500})};import{TypeSystem as K0} from"@sinclair/typebox/system";import{Type as s1,FormatRegistry as a1} from"@sinclair/typebox";import{Value as L$} from"@sinclair/typebox/value";import{TypeSystemPolicy as v6,TypeSystem as u6,TypeSystemDuplicateFormat as k6,TypeSystemDuplicateTypeKind as m6} from"@sinclair/typebox/system";import{TypeCompiler as c6,TypeCheck as d6} from"@sinclair/typebox/compiler";var C=Object.assign({},s1);try{K0.Format("email",($)=>/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i.test($)),K0.Format("uuid",($)=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test($)),K0.Format("date",($)=>!Number.isNaN(new Date($).getTime())),K0.Format("date-time",($)=>!Number.isNaN(new Date($).getTime()))}catch{}var t1=($)=>{if(typeof $==="string")switch($.slice(-1)){case"k":return+$.slice(0,$.length-1)*1024;case"m":return+$.slice(0,$.length-1)*1048576;default:return+$}return $},G1=($,W)=>{if(!(W instanceof Blob))return!1;if($.minSize&&W.size<t1($.minSize))return!1;if($.maxSize&&W.size>t1($.maxSize))return!1;if($.extension)if(typeof $.extension==="string"){if(!W.type.startsWith($.extension))return!1}else{for(let Z=0;Z<$.extension.length;Z++)if(W.type.startsWith($.extension[Z]))return!0;return!1}return!0},b$=K0.Type("Files",($,W)=>{if(!Array.isArray(W))return G1($,W);if($.minItems&&W.length<$.minItems)return!1;if($.maxItems&&W.length>$.maxItems)return!1;for(let Z=0;Z<W.length;Z++)if(!G1($,W[Z]))return!1;return!0});a1.Set("numeric",($)=>!!$&&!isNaN(+$));a1.Set("ObjectString",($)=>{let W=$.charCodeAt(0);if(W===9||W===10||W===32)W=$.trimStart().charCodeAt(0);if(W!==123&&W!==91)return!1;try{return JSON.parse($),!0}catch{return!1}});var W0={Numeric:($)=>{const W=s1.Number($);return C.Transform(C.Union([C.String({format:"numeric",default:0}),C.Number($)],$)).Decode((Z)=>{const X=+Z;if(isNaN(X))return Z;if($&&!L$.Check(W,X))throw new T("property",W,X);return X}).Encode((Z)=>Z)},ObjectString:($,W)=>C.Transform(C.Union([C.String({format:"ObjectString",default:""}),C.Object($,W)],W)).Decode((Z)=>{if(typeof Z==="string")try{return JSON.parse(Z)}catch{return Z}return Z}).Encode((Z)=>JSON.stringify(Z)),File:K0.Type("File",G1),Files:($={})=>C.Transform(C.Union([b$($)])).Decode((W)=>{if(Array.isArray(W))return W;return[W]}).Encode((W)=>W),Nullable:($)=>C.Union([C.Null(),$]),MaybeEmpty:($)=>C.Union([C.Null(),C.Undefined(),$]),Cookie:($,W)=>C.Object($,W)};C.ObjectString=W0.ObjectString;C.Numeric=W0.Numeric;C.File=($={})=>W0.File({default:"File",...$,extension:$?.type,type:"string",format:"binary"});C.Files=($={})=>W0.Files({...$,elysiaMeta:"Files",default:"Files",extension:$?.type,type:"array",items:{...$,default:"Files",type:"string",format:"binary"}});C.Nullable=($)=>W0.Nullable($);C.MaybeEmpty=W0.MaybeEmpty;C.Cookie=W0.Cookie;class n{config;dependencies={};store={};decorators={};definitions={type:{},error:{}};schema={};macros=[];event={start:[],request:[],parse:[],transform:[],beforeHandle:[],afterHandle:[],mapResponse:[],onResponse:[],trace:[],error:[],stop:[]};reporter=new O1;server=null;getServer(){return this.server}validator=null;router=new a;wsRouter=new a;routes=[];staticRouter={handlers:[],variables:"",map:{},all:""};wsPaths={};dynamicRouter=new a;lazyLoadModules=[];path="";stack=void 0;constructor($){if(this.config={forceErrorEncapsulation:!0,prefix:"",aot:!0,strictPath:!1,scoped:!1,cookie:{},analytic:!1,...$,seed:$?.seed===void 0?"":$?.seed},$?.analytic&&($?.name||$?.seed!==void 0))this.stack=new Error().stack}add($,W,Z,X,{allowMeta:J=!1,skipPrefix:Q=!1}={allowMeta:!1,skipPrefix:!1}){if(typeof W==="string")W=[W];for(let Y of W){if(Y=Y===""?Y:Y.charCodeAt(0)===47?Y:`/${Y}`,this.config.prefix&&!Q&&!this.config.scoped)Y=this.config.prefix+Y;if(X?.type)switch(X.type){case"text":X.type="text/plain";break;case"json":X.type="application/json";break;case"formdata":X.type="multipart/form-data";break;case"urlencoded":X.type="application/x-www-form-urlencoded";break;case"arrayBuffer":X.type="application/octet-stream";break;default:break}const _=this.definitions.type;let B=p(X?.cookie??this.validator?.cookie,{dynamic:!this.config.aot,models:_,additionalProperties:!0});if(m(this.config.cookie??{}))if(B)B.schema=V1(B.schema,this.config.cookie??{});else B=p(C.Cookie({},this.config.cookie),{dynamic:!this.config.aot,models:_,additionalProperties:!0});const K={body:p(X?.body??this.validator?.body,{dynamic:!this.config.aot,models:_}),headers:p(X?.headers??this.validator?.headers,{dynamic:!this.config.aot,models:_,additionalProperties:!0}),params:p(X?.params??this.validator?.params,{dynamic:!this.config.aot,models:_}),query:p(X?.query??this.validator?.query,{dynamic:!this.config.aot,models:_}),cookie:B,response:s0(X?.response??this.validator?.response,{dynamic:!this.config.aot,models:_})},D=this.event,U=Y.endsWith("/")?Y.slice(0,Y.length-1):Y+"/";if(this.macros.length){const M=(P)=>(w,G)=>{if(typeof w==="function"||Array.isArray(w)){if(!X[P])X[P]=[];if(typeof X[P]==="function")X[P]=[X[P]];if(Array.isArray(w))X[P]=X[P].concat(w);else X[P].push(w);return}const{insert:u="after",stack:w0="local"}=w;if(w0==="global"){if(!Array.isArray(G))if(u==="before")D[P].unshift(G);else D[P].push(G);else if(u==="before")D[P]=G.concat(D[P]);else D[P]=D[P].concat(G);return}else{if(!X[P])X[P]=[];if(typeof X[P]==="function")X[P]=[X[P]];if(!Array.isArray(G))if(u==="before")X[P].unshift(G);else X[P].push(G);else if(u==="before")X[P]=G.concat(X[P]);else X[P]=X[P].concat(G);return}},N={events:{global:D,local:X},onParse:M("parse"),onTransform:M("transform"),onBeforeHandle:M("beforeHandle"),onAfterHandle:M("afterHandle"),onResponse:M("onResponse"),onError:M("error")};for(let P of this.macros)o0(P(N),X)}const V=s(D,X),F=typeof Z==="function";if(this.config.aot===!1){if(this.dynamicRouter.add($,Y,{validator:K,hooks:V,content:X?.type,handle:Z}),this.config.strictPath===!1)this.dynamicRouter.add($,U,{validator:K,hooks:V,content:X?.type,handle:Z});this.routes.push({method:$,path:Y,composed:null,handler:Z,hooks:V});return}const z=n1({path:Y,method:$,hooks:V,validator:K,handler:Z,handleError:this.handleError,onRequest:this.event.request,config:this.config,definitions:J?this.definitions.type:void 0,schema:J?this.schema:void 0,getReporter:()=>this.reporter,setHeader:this.setHeaders});if(!F){const M=Object.assign({headers:{},query:{},params:{},body:void 0,request:new Request(`http://localhost${Y}`),store:this.store,path:Y,set:{headers:this.setHeaders??{},status:200}},this.decorators);let N;for(let P of Object.values(V.request))try{const w=y(P(M),M.set);if(w!==void 0){N=w;break}}catch(w){N=this.handleError(M,w);break}if(N)z.response=N;else try{z.response=z(M)}catch(P){z.response=this.handleError(M,P)}}const A=this.routes.findIndex((M)=>M.path===Y&&M.method===$);if(A!==-1)this.routes.splice(A,1);if(this.routes.push({method:$,path:Y,composed:z,handler:Z,hooks:V}),$==="$INTERNALWS"){const M=this.config.strictPath?void 0:Y.endsWith("/")?Y.slice(0,Y.length-1):Y+"/";if(Y.indexOf(":")===-1&&Y.indexOf("*")===-1){const N=this.staticRouter.handlers.length;if(this.staticRouter.handlers.push(z),z.response instanceof Response)this.staticRouter.variables+=`const st${N} = staticRouter.handlers[${N}].response\n`;else this.staticRouter.variables+=`const st${N} = staticRouter.handlers[${N}]\n`;if(this.wsPaths[Y]=N,M)this.wsPaths[M]=N}else if(this.wsRouter.add("ws",Y,z),M)this.wsRouter.add("ws",M,z);return}if(Y.indexOf(":")===-1&&Y.indexOf("*")===-1){const M=this.staticRouter.handlers.length;if(this.staticRouter.handlers.push(z),z.response instanceof Response)this.staticRouter.variables+=`const st${M} = staticRouter.handlers[${M}].response\n`;else this.staticRouter.variables+=`const st${M} = staticRouter.handlers[${M}]\n`;if(!this.staticRouter.map[Y])this.staticRouter.map[Y]={code:""};if($==="ALL")this.staticRouter.map[Y].all=`default: return st${M}(ctx)\n`;else if(z.response instanceof Response)this.staticRouter.map[Y].code=`case '${$}': return st${M}.clone()\n${this.staticRouter.map[Y].code}`;else this.staticRouter.map[Y].code=`case '${$}': return st${M}(ctx)\n${this.staticRouter.map[Y].code}`;if(!this.config.strictPath){if(!this.staticRouter.map[U])this.staticRouter.map[U]={code:""};if($==="ALL")this.staticRouter.map[U].all=`default: return st${M}(ctx)\n`;else if(z.response instanceof Response)this.staticRouter.map[U].code=`case '${$}': return st${M}.clone()\n${this.staticRouter.map[U].code}`;else this.staticRouter.map[U].code=`case '${$}': return st${M}(ctx)\n${this.staticRouter.map[U].code}`}}else if(this.router.add($,Y,z),!this.config.strictPath)this.router.add($,Y.endsWith("/")?Y.slice(0,Y.length-1):Y+"/",z)}}setHeaders;headers($){if(!$)return this;if(!this.setHeaders)this.setHeaders={};return this.setHeaders=d(this.setHeaders,$),this}onStart($){return this.on("start",$),this}onRequest($){return this.on("request",$),this}onParse($){return this.on("parse",$),this}onTransform($){return this.on("transform",$),this}resolve($){return $.$elysia="resolve",this.onBeforeHandle($)}onBeforeHandle($){return this.on("beforeHandle",$),this}onAfterHandle($){return this.on("afterHandle",$),this}mapResponse($){return this.on("mapResponse",$),this}onResponse($){return this.on("response",$),this}trace($){return this.reporter.on("event",N1(()=>this.reporter,this.event.trace.length,$)),this.on("trace",$),this}error($,W){switch(typeof $){case"string":return W.prototype[_0]=$,this.definitions.error[$]=W,this;case"function":return this.definitions.error=$(this.definitions.error),this}for(let[Z,X]of Object.entries($))X.prototype[_0]=Z,this.definitions.error[Z]=X;return this}onError($){return this.on("error",$),this}onStop($){return this.on("stop",$),this}on($,W){for(let Z of Array.isArray(W)?W:[W])switch(Z=w1(Z),$){case"start":this.event.start.push(Z);break;case"request":this.event.request.push(Z);break;case"parse":this.event.parse.splice(this.event.parse.length-1,0,Z);break;case"transform":this.event.transform.push(Z);break;case"beforeHandle":this.event.beforeHandle.push(Z);break;case"afterHandle":this.event.afterHandle.push(Z);break;case"mapResponse":this.event.mapResponse.push(Z);break;case"response":this.event.onResponse.push(Z);break;case"trace":this.event.trace.push(Z);break;case"error":this.event.error.push(Z);break;case"stop":this.event.stop.push(Z);break}return this}group($,W,Z){const X=new n({...this.config,prefix:""});X.store=this.store,X.definitions=this.definitions,X.getServer=()=>this.server;const J=typeof W==="object",Q=(J?Z:W)(X);if(this.decorators=d(this.decorators,X.decorators),Q.event.request.length)this.event.request=[...this.event.request,...Q.event.request];if(Q.event.onResponse.length)this.event.onResponse=[...this.event.onResponse,...Q.event.onResponse];return this.model(Q.definitions.type),Object.values(X.routes).forEach(({method:Y,path:_,handler:B,hooks:K})=>{if(_=(J?"":this.config.prefix)+$+_,J){const D=W,U=K;this.add(Y,_,B,s(D,{...U,error:!U.error?Q.event.error:Array.isArray(U.error)?[...U.error,...Q.event.error]:[U.error,...Q.event.error]}))}else this.add(Y,_,B,s(K,{error:Q.event.error}),{skipPrefix:!0})}),this}guard($,W){if(!W)return this.event=v0(this.event,$),this.validator={body:$.body,headers:$.headers,params:$.params,query:$.query,response:$.response},this;const Z=new n({...this.config,prefix:""});Z.store=this.store,Z.definitions=this.definitions;const X=W(Z);if(this.decorators=d(this.decorators,Z.decorators),X.event.request.length)this.event.request=[...this.event.request,...X.event.request];if(X.event.onResponse.length)this.event.onResponse=[...this.event.onResponse,...X.event.onResponse];return this.model(X.definitions.type),Object.values(Z.routes).forEach(({method:J,path:Q,handler:Y,hooks:_})=>{this.add(J,Q,Y,s($,{..._,error:!_.error?X.event.error:Array.isArray(_.error)?[..._.error,...X.event.error]:[_.error,...X.event.error]}))}),this}use($){if($ instanceof Promise)return this.lazyLoadModules.push($.then((W)=>{if(typeof W==="function")return W(this);if(typeof W.default==="function")return W.default(this);return this._use(W)}).then((W)=>W.compile())),this;else return this._use($);return this}_use($){if(typeof $==="function"){const J=$(this);if(J instanceof Promise)return this.lazyLoadModules.push(J.then((Q)=>{if(Q instanceof n){this.compile();for(let{method:Y,path:_,handler:B,hooks:K}of Object.values(Q.routes))this.add(Y,_,B,s(K,{error:Q.event.error}));return Q}if(typeof Q==="function")return Q(this);if(typeof Q.default==="function")return Q.default(this);return this._use(Q)}).then((Q)=>Q.compile())),this;return J}const{name:W,seed:Z}=$.config;$.getServer=()=>this.getServer(),this.headers($.setHeaders);const X=$.config.scoped;if(X){if(W){if(!(W in this.dependencies))this.dependencies[W]=[];const Q=Z!==void 0?N0(W+JSON.stringify(Z)):0;if(this.dependencies[W].some(({checksum:Y})=>Q===Y))return this;this.dependencies[W].push(!this.config?.analytic?{name:$.config.name,seed:$.config.seed,checksum:Q,dependencies:$.dependencies}:{name:$.config.name,seed:$.config.seed,checksum:Q,dependencies:$.dependencies,stack:$.stack,routes:$.routes,decorators:$.decorators,store:$.store,type:$.definitions.type,error:$.definitions.error,derive:$.event.transform.filter((Y)=>Y.$elysia==="derive").map((Y)=>({fn:Y.toString(),stack:new Error().stack??""})),resolve:$.event.transform.filter((Y)=>Y.$elysia==="derive").map((Y)=>({fn:Y.toString(),stack:new Error().stack??""}))})}if($.model(this.definitions.type),$.error(this.definitions.error),$.macros=[...this.macros,...$.macros],$.onRequest((Q)=>{Object.assign(Q,this.decorators),Object.assign(Q.store,this.store)}),$.event.trace=[...this.event.trace,...$.event.trace],$.config.aot)$.compile();if(X&&!$.config.prefix)console.warn("When using scoped plugins it is recommended to use a prefix, else routing may not work correctly for the second scoped instance");let J;if(X&&$.config.prefix)J=this.mount($.config.prefix+"/",$.fetch);else J=this.mount($.fetch);return this.routes=this.routes.concat(J.routes),this}else{$.reporter=this.reporter;for(let J of $.event.trace)this.trace(J);if(W){if(!(W in this.dependencies))this.dependencies[W]=[];const J=Z!==void 0?N0(W+JSON.stringify(Z)):0;if(!this.dependencies[W].some(({checksum:Y})=>J===Y))this.macros.push(...$.macros);const Q=[];for(let Y=0;Y<this.macros.length;Y++){const _=this.macros[Y];if(Q.includes(_.$elysiaChecksum))this.macros.splice(Y,1),Y--;Q.push(_.$elysiaChecksum)}}}this.decorate($.decorators),this.state($.store),this.model($.definitions.type),this.error($.definitions.error);for(let{method:J,path:Q,handler:Y,hooks:_}of Object.values($.routes))this.add(J,Q,Y,s(_,{error:$.event.error}));if(!X)if(W){if(!(W in this.dependencies))this.dependencies[W]=[];const J=Z!==void 0?N0(W+JSON.stringify(Z)):0;if(this.dependencies[W].some(({checksum:Q})=>J===Q))return this;this.dependencies[W].push(!this.config?.analytic?{name:$.config.name,seed:$.config.seed,checksum:J,dependencies:$.dependencies}:{name:$.config.name,seed:$.config.seed,checksum:J,dependencies:$.dependencies,stack:$.stack,routes:$.routes,decorators:$.decorators,store:$.store,type:$.definitions.type,error:$.definitions.error,derive:$.event.transform.filter((Q)=>Q?.$elysia==="derive").map((Q)=>({fn:Q.toString(),stack:new Error().stack??""})),resolve:$.event.transform.filter((Q)=>Q?.$elysia==="resolve").map((Q)=>({fn:Q.toString(),stack:new Error().stack??""}))}),this.event=v0(this.event,a0($.event),J)}else this.event=v0(this.event,a0($.event));return this}macro($){return $.$elysiaChecksum=N0(JSON.stringify({name:this.config.name,seed:this.config.seed,content:$.toString()})),this.macros.push($),this}mount($,W){if($ instanceof n||typeof $==="function"||$.length===0||$==="/"){const J=typeof $==="function"?$:$ instanceof n?$.compile().fetch:W instanceof n?W.compile().fetch:W,Q=async({request:Y,path:_})=>J(new Request(t0(Y.url,_||"/"),Y));return this.all("/",Q,{type:"none"}),this.all("/*",Q,{type:"none"}),this}const Z=$.length;if(W instanceof n)W=W.compile().fetch;const X=async({request:J,path:Q})=>W(new Request(t0(J.url,Q.slice(Z)||"/"),J));return this.all($,X,{type:"none"}),this.all($+($.endsWith("/")?"*":"/*"),X,{type:"none"}),this}get($,W,Z){return this.add("GET",$,W,Z),this}post($,W,Z){return this.add("POST",$,W,Z),this}put($,W,Z){return this.add("PUT",$,W,Z),this}patch($,W,Z){return this.add("PATCH",$,W,Z),this}delete($,W,Z){return this.add("DELETE",$,W,Z),this}options($,W,Z){return this.add("OPTIONS",$,W,Z),this}all($,W,Z){return this.add("ALL",$,W,Z),this}head($,W,Z){return this.add("HEAD",$,W,Z),this}connect($,W,Z){return this.add("CONNECT",$,W,Z),this}ws($,W){const Z=W.transformMessage?Array.isArray(W.transformMessage)?W.transformMessage:[W.transformMessage]:void 0;let X=null;const J=p(W?.body,{models:this.definitions.type}),Q=p(W?.response,{models:this.definitions.type}),Y=(_)=>{if(typeof _==="string"){const B=_?.charCodeAt(0);if(B===47||B===123)try{_=JSON.parse(_)}catch{}else if(f0(_))_=+_}if(Z?.length)for(let B=0;B<Z.length;B++){const K=Z[B](_);if(K!==void 0)_=K}return _};return this.route("$INTERNALWS",$,(_)=>{const{set:B,path:K,qi:D,headers:U,query:V,params:F}=_;if(X===null)X=this.getServer();if(X?.upgrade(_.request,{headers:typeof W.upgrade==="function"?W.upgrade(_):W.upgrade,data:{validator:Q,open(z){W.open?.(new G0(z,_))},message:(z,A)=>{const M=Y(A);if(J?.Check(M)===!1)return void z.send(new T("message",J,M).message);W.message?.(new G0(z,_),M)},drain(z){W.drain?.(new G0(z,_))},close(z,A,M){W.close?.(new G0(z,_),A,M)}}}))return;return B.status=400,"Expected a websocket connection"},{beforeHandle:W.beforeHandle,transform:W.transform,headers:W.headers,params:W.params,query:W.query}),this}route($,W,Z,{config:X,...J}={config:{allowMeta:!1}}){return this.add($,W,Z,J,X),this}state($,W){switch(typeof $){case"object":return this.store=d(this.store,$),this;case"function":return this.store=$(this.store),this}if(!($ in this.store))this.store[$]=W;return this}decorate($,W){switch(typeof $){case"object":return this.decorators=d(this.decorators,$),this;case"function":return this.decorators=$(this.decorators),this}if(!($ in this.decorators))this.decorators[$]=W;return this}derive($){return $.$elysia="derive",this.onTransform($)}model($,W){switch(typeof $){case"object":return Object.entries($).forEach(([Z,X])=>{if(!(Z in this.definitions.type))this.definitions.type[Z]=X}),this;case"function":return this.definitions.type=$(this.definitions.type),this}return this.definitions.type[$]=W,this}mapDerive($){return $.$elysia="derive",this.onTransform($)}affix($,W,Z){if(Z==="")return this;const X=["_","-"," "],J=(B)=>B[0].toUpperCase()+B.slice(1),Q=$==="prefix"?(B,K)=>X.includes(B.at(-1)??"")?B+K:B+J(K):X.includes(Z.at(-1)??"")?(B,K)=>K+B:(B,K)=>K+J(B),Y=(B)=>{const K={};switch(B){case"decorator":for(let D in this.decorators)K[Q(Z,D)]=this.decorators[D];this.decorators=K;break;case"state":for(let D in this.store)K[Q(Z,D)]=this.store[D];this.store=K;break;case"model":for(let D in this.definitions.type)K[Q(Z,D)]=this.definitions.type[D];this.definitions.type=K;break;case"error":for(let D in this.definitions.error)K[Q(Z,D)]=this.definitions.error[D];this.definitions.error=K;break}},_=Array.isArray(W)?W:[W];for(let B of _.some((K)=>K==="all")?["decorator","state","model","error"]:_)Y(B);return this}prefix($,W){return this.affix("prefix",$,W)}suffix($,W){return this.affix("suffix",$,W)}compile(){if(this.fetch=this.config.aot?Q1(this):_1(this),typeof this.server?.reload==="function")this.server.reload({...this.server,fetch:this.fetch});return this}handle=async($)=>this.fetch($);fetch=($)=>{return(this.fetch=this.config.aot?Q1(this):_1(this))($)};handleError=async($,W)=>(this.handleError=this.config.aot?B1(this):r1(this))($,W);outerErrorHandler=($)=>new Response($.message||$.name||"Error",{status:$?.status??500});listen=($,W)=>{if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only. If you are running Elysia in other environment please use a dedicated plugin or export the handler via Elysia.fetch");if(this.compile(),typeof $==="string"){if($=+$.trim(),Number.isNaN($))throw new Error("Port must be a numeric value")}const Z=this.fetch,X=typeof $==="object"?{development:!P0,reusePort:!0,...this.config.serve,...$,websocket:{...this.config.websocket,...$1},fetch:Z,error:this.outerErrorHandler}:{development:!P0,reusePort:!0,...this.config.serve,websocket:{...this.config.websocket,...$1},port:$,fetch:Z,error:this.outerErrorHandler};if(this.server=Bun?.serve(X),this.event.start.length)for(let J=0;J<this.event.start.length;J++)this.event.start[J](this);if(W)W(this.server);return process.on("beforeExit",()=>{for(let J=0;J<this.event.stop.length;J++)this.event.stop[J](this)}),Promise.all(this.lazyLoadModules).then(()=>{Bun?.gc(!1)}),this};stop=async()=>{if(!this.server)throw new Error("Elysia isn't running. Call `app.listen` to start the server.");if(this.server.stop(),this.event.stop.length)for(let $=0;$<this.event.stop.length;$++)this.event.stop[$](this)};get modules(){return Promise.all(this.lazyLoadModules)}}export{C as t,H as mergeObjectArray,s as mergeHook,d as mergeDeep,v as mapResponse,y as mapEarlyResponse,l as mapCompactResponse,p as getSchemaValidator,s0 as getResponseSchemaValidator,P$ as error,n as default,T as ValidationError,C1 as ParseError,o as NotFoundError,U0 as InvalidCookieSignature,u0 as InternalServerError,n as Elysia,k as Cookie};

//# debugId=6D7269FE88B932B664756e2164756e21
